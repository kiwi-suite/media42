!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["angular-file-upload"]=t():e["angular-file-upload"]=t()}(this,function(){return function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var r=o(1),i=n(r),s=o(2),a=n(s),l=o(3),u=n(l),p=o(4),c=n(p),f=o(5),d=n(f),h=o(6),y=n(h),m=o(7),_=n(m),v=o(8),g=n(v),F=o(9),b=n(F),O=o(10),C=n(O),I=o(11),U=n(I),w=o(12),A=n(w);angular.module(i["default"].name,[]).value("fileUploaderOptions",a["default"]).factory("FileUploader",u["default"]).factory("FileLikeObject",c["default"]).factory("FileItem",d["default"]).factory("FileDirective",y["default"]).factory("FileSelect",_["default"]).factory("FileDrop",g["default"]).factory("FileOver",b["default"]).directive("nvFileSelect",C["default"]).directive("nvFileDrop",U["default"]).directive("nvFileOver",A["default"]).run(["FileUploader","FileLikeObject","FileItem","FileDirective","FileSelect","FileDrop","FileOver",function(e,t,o,n,r,i,s){e.FileLikeObject=t,e.FileItem=o,e.FileDirective=n,e.FileSelect=r,e.FileDrop=i,e.FileOver=s}])},function(e,t){e.exports={name:"angularFileUpload"}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={url:"/",alias:"file",headers:{},queue:[],progress:0,autoUpload:!1,removeAfterUpload:!1,method:"POST",filters:[],formData:[],queueLimit:Number.MAX_VALUE,withCredentials:!1,disableMultipart:!1}},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,o,n,i,s,a){var m=n.File,_=n.FormData,v=function(){function n(t){r(this,n);var o=l(e);u(this,o,t,{isUploading:!1,_nextIndex:0,_failFilterIndex:-1,_directives:{select:[],drop:[],over:[]}}),this.filters.unshift({name:"queueLimit",fn:this._queueLimitFilter}),this.filters.unshift({name:"folder",fn:this._folderFilter})}return n.prototype.addToQueue=function(e,t,o){var n=this,r=this.isArrayLikeObject(e)?e:[e],i=this._getFilters(o),l=this.queue.length,u=[];p(r,function(e){var o=new s(e);if(n._isValidFile(o,i,t)){var r=new a(n,e,t);u.push(r),n.queue.push(r),n._onAfterAddingFile(r)}else{var l=i[n._failFilterIndex];n._onWhenAddingFileFailed(o,l,t)}}),this.queue.length!==l&&(this._onAfterAddingAll(u),this.progress=this._getTotalProgress()),this._render(),this.autoUpload&&this.uploadAll()},n.prototype.removeFromQueue=function(e){var t=this.getIndexOfItem(e),o=this.queue[t];o.isUploading&&o.cancel(),this.queue.splice(t,1),o._destroy(),this.progress=this._getTotalProgress()},n.prototype.clearQueue=function(){for(;this.queue.length;)this.queue[0].remove();this.progress=0},n.prototype.uploadItem=function(e){var t=this.getIndexOfItem(e),o=this.queue[t],n=this.isHTML5?"_xhrTransport":"_iframeTransport";o._prepareToUploading(),this.isUploading||(this._onBeforeUploadItem(o),o.isCancel||(o.isUploading=!0,this.isUploading=!0,this[n](o),this._render()))},n.prototype.cancelItem=function(e){var t=this,o=this.getIndexOfItem(e),n=this.queue[o],r=this.isHTML5?"_xhr":"_form";n&&(n.isCancel=!0,n.isUploading?n[r].abort():!function(){var e=[void 0,0,{}],o=function(){t._onCancelItem.apply(t,[n].concat(e)),t._onCompleteItem.apply(t,[n].concat(e))};i(o)}())},n.prototype.uploadAll=function(){var e=this.getNotUploadedItems().filter(function(e){return!e.isUploading});e.length&&(p(e,function(e){return e._prepareToUploading()}),e[0].upload())},n.prototype.cancelAll=function(){var e=this.getNotUploadedItems();p(e,function(e){return e.cancel()})},n.prototype.isFile=function(e){return this.constructor.isFile(e)},n.prototype.isFileLikeObject=function(e){return this.constructor.isFileLikeObject(e)},n.prototype.isArrayLikeObject=function(e){return this.constructor.isArrayLikeObject(e)},n.prototype.getIndexOfItem=function(e){return f(e)?e:this.queue.indexOf(e)},n.prototype.getNotUploadedItems=function(){return this.queue.filter(function(e){return!e.isUploaded})},n.prototype.getReadyItems=function(){return this.queue.filter(function(e){return e.isReady&&!e.isUploading}).sort(function(e,t){return e.index-t.index})},n.prototype.destroy=function(){var e=this;p(this._directives,function(t){p(e._directives[t],function(e){e.destroy()})})},n.prototype.onAfterAddingAll=function(e){},n.prototype.onAfterAddingFile=function(e){},n.prototype.onWhenAddingFileFailed=function(e,t,o){},n.prototype.onBeforeUploadItem=function(e){},n.prototype.onProgressItem=function(e,t){},n.prototype.onProgressAll=function(e){},n.prototype.onSuccessItem=function(e,t,o,n){},n.prototype.onErrorItem=function(e,t,o,n){},n.prototype.onCancelItem=function(e,t,o,n){},n.prototype.onCompleteItem=function(e,t,o,n){},n.prototype.onCompleteAll=function(){},n.prototype._getTotalProgress=function(e){if(this.removeAfterUpload)return e||0;var t=this.getNotUploadedItems().length,o=t?this.queue.length-t:this.queue.length,n=100/this.queue.length,r=(e||0)*n/100;return Math.round(o*n+r)},n.prototype._getFilters=function(e){if(!e)return this.filters;if(h(e))return e;var t=e.match(/[^\s,]+/g);return this.filters.filter(function(e){return-1!==t.indexOf(e.name)})},n.prototype._render=function(){t.$$phase||t.$apply()},n.prototype._folderFilter=function(e){return!(!e.size&&!e.type)},n.prototype._queueLimitFilter=function(){return this.queue.length<this.queueLimit},n.prototype._isValidFile=function(e,t,o){var n=this;return this._failFilterIndex=-1,t.length?t.every(function(t){return n._failFilterIndex++,t.fn.call(n,e,o)}):!0},n.prototype._isSuccessCode=function(e){return e>=200&&300>e||304===e},n.prototype._transformResponse=function(e,t){var n=this._headersGetter(t);return p(o.defaults.transformResponse,function(t){e=t(e,n)}),e},n.prototype._parseHeaders=function(e){var t,o,n,r={};return e?(p(e.split("\n"),function(e){n=e.indexOf(":"),t=e.slice(0,n).trim().toLowerCase(),o=e.slice(n+1).trim(),t&&(r[t]=r[t]?r[t]+", "+o:o)}),r):r},n.prototype._headersGetter=function(e){return function(t){return t?e[t.toLowerCase()]||null:e}},n.prototype._xhrTransport=function(e){var t,o=this,n=e._xhr=new XMLHttpRequest;if(e.disableMultipart?t=e._file:(t=new _,p(e.formData,function(e){p(e,function(e,o){t.append(o,e)})}),t.append(e.alias,e._file,e.file.name)),"number"!=typeof e._file.size)throw new TypeError("The file specified is no longer valid");n.upload.onprogress=function(t){var n=Math.round(t.lengthComputable?100*t.loaded/t.total:0);o._onProgressItem(e,n)},n.onload=function(){var t=o._parseHeaders(n.getAllResponseHeaders()),r=o._transformResponse(n.response,t),i=o._isSuccessCode(n.status)?"Success":"Error",s="_on"+i+"Item";o[s](e,r,n.status,t),o._onCompleteItem(e,r,n.status,t)},n.onerror=function(){var t=o._parseHeaders(n.getAllResponseHeaders()),r=o._transformResponse(n.response,t);o._onErrorItem(e,r,n.status,t),o._onCompleteItem(e,r,n.status,t)},n.onabort=function(){var t=o._parseHeaders(n.getAllResponseHeaders()),r=o._transformResponse(n.response,t);o._onCancelItem(e,r,n.status,t),o._onCompleteItem(e,r,n.status,t)},n.open(e.method,e.url,!0),n.withCredentials=e.withCredentials,p(e.headers,function(e,t){n.setRequestHeader(t,e)}),n.send(t)},n.prototype._iframeTransport=function(e){var t=this,o=y('<form style="display: none;" />'),n=y('<iframe name="iframeTransport'+Date.now()+'">'),r=e._input;e._form&&e._form.replaceWith(r),e._form=o,r.prop("name",e.alias),p(e.formData,function(e){p(e,function(e,t){var n=y('<input type="hidden" name="'+t+'" />');n.val(e),o.append(n)})}),o.prop({action:e.url,method:"POST",target:n.prop("name"),enctype:"multipart/form-data",encoding:"multipart/form-data"}),n.bind("load",function(){var o="",r=200;try{o=n[0].contentDocument.body.innerHTML}catch(i){r=500}var s={response:o,status:r,dummy:!0},a={},l=t._transformResponse(s.response,a);t._onSuccessItem(e,l,s.status,a),t._onCompleteItem(e,l,s.status,a)}),o.abort=function(){var i,s={status:0,dummy:!0},a={};n.unbind("load").prop("src","javascript:false;"),o.replaceWith(r),t._onCancelItem(e,i,s.status,a),t._onCompleteItem(e,i,s.status,a)},r.after(o),o.append(r).append(n),o[0].submit()},n.prototype._onWhenAddingFileFailed=function(e,t,o){this.onWhenAddingFileFailed(e,t,o)},n.prototype._onAfterAddingFile=function(e){this.onAfterAddingFile(e)},n.prototype._onAfterAddingAll=function(e){this.onAfterAddingAll(e)},n.prototype._onBeforeUploadItem=function(e){e._onBeforeUpload(),this.onBeforeUploadItem(e)},n.prototype._onProgressItem=function(e,t){var o=this._getTotalProgress(t);this.progress=o,e._onProgress(t),this.onProgressItem(e,t),this.onProgressAll(o),this._render()},n.prototype._onSuccessItem=function(e,t,o,n){e._onSuccess(t,o,n),this.onSuccessItem(e,t,o,n)},n.prototype._onErrorItem=function(e,t,o,n){e._onError(t,o,n),this.onErrorItem(e,t,o,n)},n.prototype._onCancelItem=function(e,t,o,n){e._onCancel(t,o,n),this.onCancelItem(e,t,o,n)},n.prototype._onCompleteItem=function(e,t,o,n){e._onComplete(t,o,n),this.onCompleteItem(e,t,o,n);var r=this.getReadyItems()[0];return this.isUploading=!1,d(r)?void r.upload():(this.onCompleteAll(),this.progress=this._getTotalProgress(),void this._render())},n.isFile=function(e){return m&&e instanceof m},n.isFileLikeObject=function(e){return e instanceof s},n.isArrayLikeObject=function(e){return c(e)&&"length"in e},n.inherit=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.super_=t},n}();return v.prototype.isHTML5=!(!m||!_),v.isHTML5=v.prototype.isHTML5,v}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var s=o(1),a=(n(s),angular),l=a.copy,u=a.extend,p=a.forEach,c=a.isObject,f=a.isNumber,d=a.isDefined,h=a.isArray,y=a.element;i.$inject=["fileUploaderOptions","$rootScope","$http","$window","$timeout","FileLikeObject","FileItem"]},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(){return function(){function e(t){r(this,e);var o=u(t),n=o?t.value:t,i=p(n)?"FakePath":"Object",s="_createFrom"+i;this[s](n)}return e.prototype._createFromFakePath=function(e){this.lastModifiedDate=null,this.size=null,this.type="like/"+e.slice(e.lastIndexOf(".")+1).toLowerCase(),this.name=e.slice(e.lastIndexOf("/")+e.lastIndexOf("\\")+2)},e.prototype._createFromObject=function(e){this.lastModifiedDate=l(e.lastModifiedDate),this.size=e.size,this.type=e.type,this.name=e.name},e}()}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var s=o(1),a=(n(s),angular),l=a.copy,u=a.isElement,p=a.isString},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){return function(){function o(e,n,i){r(this,o);var s=c(n),a=s?p(n):null,f=s?null:n;u(this,{url:e.url,alias:e.alias,headers:l(e.headers),formData:l(e.formData),removeAfterUpload:e.removeAfterUpload,withCredentials:e.withCredentials,disableMultipart:e.disableMultipart,method:e.method},i,{uploader:e,file:new t(n),isReady:!1,isUploading:!1,isUploaded:!1,isSuccess:!1,isCancel:!1,isError:!1,progress:0,index:null,_file:f,_input:a}),a&&this._replaceNode(a)}return o.prototype.upload=function(){try{this.uploader.uploadItem(this)}catch(e){this.uploader._onCompleteItem(this,"",0,[]),this.uploader._onErrorItem(this,"",0,[])}},o.prototype.cancel=function(){this.uploader.cancelItem(this)},o.prototype.remove=function(){this.uploader.removeFromQueue(this)},o.prototype.onBeforeUpload=function(){},o.prototype.onProgress=function(e){},o.prototype.onSuccess=function(e,t,o){},o.prototype.onError=function(e,t,o){},o.prototype.onCancel=function(e,t,o){},o.prototype.onComplete=function(e,t,o){},o.prototype._onBeforeUpload=function(){this.isReady=!0,this.isUploading=!1,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!1,this.isError=!1,this.progress=0,this.onBeforeUpload()},o.prototype._onProgress=function(e){this.progress=e,this.onProgress(e)},o.prototype._onSuccess=function(e,t,o){this.isReady=!1,this.isUploading=!1,this.isUploaded=!0,this.isSuccess=!0,this.isCancel=!1,this.isError=!1,this.progress=100,this.index=null,this.onSuccess(e,t,o)},o.prototype._onError=function(e,t,o){this.isReady=!1,this.isUploading=!1,this.isUploaded=!0,this.isSuccess=!1,this.isCancel=!1,this.isError=!0,this.progress=0,this.index=null,this.onError(e,t,o)},o.prototype._onCancel=function(e,t,o){this.isReady=!1,this.isUploading=!1,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!0,this.isError=!1,this.progress=0,this.index=null,this.onCancel(e,t,o)},o.prototype._onComplete=function(e,t,o){this.onComplete(e,t,o),this.removeAfterUpload&&this.remove()},o.prototype._destroy=function(){this._input&&this._input.remove(),this._form&&this._form.remove(),delete this._form,delete this._input},o.prototype._prepareToUploading=function(){this.index=this.index||++this.uploader._nextIndex,this.isReady=!0},o.prototype._replaceNode=function(t){var o=e(t.clone())(t.scope());o.prop("value",null),t.css("display","none"),t.after(o)},o}()}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var s=o(1),a=(n(s),angular),l=a.copy,u=a.extend,p=a.element,c=a.isElement;i.$inject=["$compile","FileLikeObject"]},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(){var e=function(){function e(t){r(this,e),l(this,t),this.uploader._directives[this.prop].push(this),this._saveLinks(),this.bind()}return e.prototype.bind=function(){for(var e in this.events){var t=this.events[e];this.element.bind(e,this[t])}},e.prototype.unbind=function(){for(var e in this.events)this.element.unbind(e,this.events[e])},e.prototype.destroy=function(){var e=this.uploader._directives[this.prop].indexOf(this);this.uploader._directives[this.prop].splice(e,1),this.unbind()},e.prototype._saveLinks=function(){for(var e in this.events){var t=this.events[e];this[t]=this[t].bind(this)}},e}();return e.prototype.events={},e}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var s=o(1),a=(n(s),angular),l=a.extend},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){return function(t){function o(e){r(this,o);var n=p(e,{events:{$destroy:"destroy",change:"onChange"},prop:"select"}),s=i(this,t.call(this,n));return s.uploader.isHTML5||s.element.removeAttr("multiple"),s.element.prop("value",null),s}return s(o,t),o.prototype.getOptions=function(){},o.prototype.getFilters=function(){},o.prototype.isEmptyAfterSelection=function(){return!!this.element.attr("multiple")},o.prototype.onChange=function(){var t=this.uploader.isHTML5?this.element[0].files:this.element[0],o=this.getOptions(),n=this.getFilters();this.uploader.isHTML5||this.destroy(),this.uploader.addToQueue(t,o,n),this.isEmptyAfterSelection()&&(this.element.prop("value",null),this.element.replaceWith(e(this.element.clone())(this.scope)))},o}(t)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var l=o(1),u=(n(l),angular),p=u.extend;a.$inject=["$compile","FileDirective"]},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){return function(e){function t(o){r(this,t);var n=p(o,{events:{$destroy:"destroy",drop:"onDrop",dragover:"onDragOver",dragleave:"onDragLeave"},prop:"drop"});return i(this,e.call(this,n))}return s(t,e),t.prototype.getOptions=function(){},t.prototype.getFilters=function(){},t.prototype.onDrop=function(e){var t=this._getTransfer(e);if(t){var o=this.getOptions(),n=this.getFilters();this._preventAndStop(e),c(this.uploader._directives.over,this._removeOverClass,this),this.uploader.addToQueue(t.files,o,n)}},t.prototype.onDragOver=function(e){var t=this._getTransfer(e);this._haveFiles(t.types)&&(t.dropEffect="copy",this._preventAndStop(e),c(this.uploader._directives.over,this._addOverClass,this))},t.prototype.onDragLeave=function(e){e.currentTarget!==this.element[0]&&(this._preventAndStop(e),c(this.uploader._directives.over,this._removeOverClass,this))},t.prototype._getTransfer=function(e){return e.dataTransfer?e.dataTransfer:e.originalEvent.dataTransfer},t.prototype._preventAndStop=function(e){e.preventDefault(),e.stopPropagation()},t.prototype._haveFiles=function(e){return e?e.indexOf?-1!==e.indexOf("Files"):e.contains?e.contains("Files"):!1:!1},t.prototype._addOverClass=function(e){e.addOverClass()},t.prototype._removeOverClass=function(e){e.removeOverClass()},t}(e)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var l=o(1),u=(n(l),angular),p=u.extend,c=u.forEach;a.$inject=["FileDirective"]},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){return function(e){function t(o){r(this,t);var n=p(o,{events:{$destroy:"destroy"},prop:"over",overClass:"nv-file-over"});return i(this,e.call(this,n))}return s(t,e),t.prototype.addOverClass=function(){this.element.addClass(this.getOverClass())},t.prototype.removeOverClass=function(){this.element.removeClass(this.getOverClass())},t.prototype.getOverClass=function(){return this.overClass},t}(e)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var l=o(1),u=(n(l),angular),p=u.extend;a.$inject=["FileDirective"]},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,o){return{link:function(n,r,i){var s=n.$eval(i.uploader);if(!(s instanceof t))throw new TypeError('"Uploader" must be an instance of FileUploader');var a=new o({uploader:s,element:r,scope:n});a.getOptions=e(i.options).bind(a,n),a.getFilters=function(){return i.filters}}}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=r;var i=o(1);n(i),r.$inject=["$parse","FileUploader","FileSelect"]},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,o){return{link:function(n,r,i){var s=n.$eval(i.uploader);if(!(s instanceof t))throw new TypeError('"Uploader" must be an instance of FileUploader');if(s.isHTML5){var a=new o({uploader:s,element:r});a.getOptions=e(i.options).bind(a,n),a.getFilters=function(){return i.filters}}}}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=r;var i=o(1);n(i),r.$inject=["$parse","FileUploader","FileDrop"]},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){return{link:function(o,n,r){var i=o.$eval(r.uploader);if(!(i instanceof e))throw new TypeError('"Uploader" must be an instance of FileUploader');var s=new t({uploader:i,element:n});s.getOverClass=function(){return r.overClass||s.overClass}}}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=r;var i=o(1);n(i),r.$inject=["FileUploader","FileOver"]}])}),function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory("object"==typeof exports?require("jquery"):jQuery)}(function($){"use strict";function isNumber(n){return"number"==typeof n&&!isNaN(n)}function isUndefined(n){return"undefined"==typeof n}function toArray(obj,offset){var args=[];return isNumber(offset)&&args.push(offset),args.slice.apply(obj,args)}function proxy(fn,context){var args=toArray(arguments,2);return function(){return fn.apply(context,args.concat(toArray(arguments)))}}function isCrossOriginURL(url){var parts=url.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return parts&&(parts[1]!==location.protocol||parts[2]!==location.hostname||parts[3]!==location.port)}function addTimestamp(url){var timestamp="timestamp="+(new Date).getTime();return url+(-1===url.indexOf("?")?"?":"&")+timestamp}function getCrossOrigin(crossOrigin){return crossOrigin?' crossOrigin="'+crossOrigin+'"':""}function getImageSize(image,callback){var newImage;return image.naturalWidth&&!IS_SAFARI_OR_UIWEBVIEW?callback(image.naturalWidth,image.naturalHeight):(newImage=document.createElement("img"),newImage.onload=function(){callback(this.width,this.height)},void(newImage.src=image.src))}function getTransform(options){var transforms=[],rotate=options.rotate,scaleX=options.scaleX,scaleY=options.scaleY;return isNumber(rotate)&&0!==rotate&&transforms.push("rotate("+rotate+"deg)"),isNumber(scaleX)&&1!==scaleX&&transforms.push("scaleX("+scaleX+")"),isNumber(scaleY)&&1!==scaleY&&transforms.push("scaleY("+scaleY+")"),transforms.length?transforms.join(" "):"none"}function getRotatedSizes(data,isReversed){var newWidth,newHeight,deg=abs(data.degree)%180,arc=(deg>90?180-deg:deg)*Math.PI/180,sinArc=sin(arc),cosArc=cos(arc),width=data.width,height=data.height,aspectRatio=data.aspectRatio;return isReversed?(newWidth=width/(cosArc+sinArc/aspectRatio),newHeight=newWidth/aspectRatio):(newWidth=width*cosArc+height*sinArc,newHeight=width*sinArc+height*cosArc),{width:newWidth,height:newHeight}}function getSourceCanvas(image,data){var translateX,translateY,rotated,canvas=$("<canvas>")[0],context=canvas.getContext("2d"),dstX=0,dstY=0,dstWidth=data.naturalWidth,dstHeight=data.naturalHeight,rotate=data.rotate,scaleX=data.scaleX,scaleY=data.scaleY,scalable=isNumber(scaleX)&&isNumber(scaleY)&&(1!==scaleX||1!==scaleY),rotatable=isNumber(rotate)&&0!==rotate,advanced=rotatable||scalable,canvasWidth=dstWidth*abs(scaleX||1),canvasHeight=dstHeight*abs(scaleY||1);return scalable&&(translateX=canvasWidth/2,translateY=canvasHeight/2),rotatable&&(rotated=getRotatedSizes({width:canvasWidth,height:canvasHeight,degree:rotate}),canvasWidth=rotated.width,canvasHeight=rotated.height,translateX=canvasWidth/2,translateY=canvasHeight/2),canvas.width=canvasWidth,canvas.height=canvasHeight,advanced&&(dstX=-dstWidth/2,dstY=-dstHeight/2,context.save(),context.translate(translateX,translateY)),rotatable&&context.rotate(rotate*Math.PI/180),scalable&&context.scale(scaleX,scaleY),context.drawImage(image,floor(dstX),floor(dstY),floor(dstWidth),floor(dstHeight)),advanced&&context.restore(),canvas}function getTouchesCenter(touches){var length=touches.length,pageX=0,pageY=0;return length&&($.each(touches,function(i,touch){pageX+=touch.pageX,pageY+=touch.pageY}),pageX/=length,pageY/=length),{pageX:pageX,pageY:pageY}}function getStringFromCharCode(dataView,start,length){var i,str="";for(i=start,length+=start;length>i;i++)str+=fromCharCode(dataView.getUint8(i));return str}function getOrientation(arrayBuffer){var orientation,exifIDCode,tiffOffset,firstIFDOffset,littleEndian,endianness,app1Start,ifdStart,offset,i,dataView=new DataView(arrayBuffer),length=dataView.byteLength;if(255===dataView.getUint8(0)&&216===dataView.getUint8(1))for(offset=2;length>offset;){if(255===dataView.getUint8(offset)&&225===dataView.getUint8(offset+1)){app1Start=offset;break}offset++}if(app1Start&&(exifIDCode=app1Start+4,tiffOffset=app1Start+10,"Exif"===getStringFromCharCode(dataView,exifIDCode,4)&&(endianness=dataView.getUint16(tiffOffset),littleEndian=18761===endianness,(littleEndian||19789===endianness)&&42===dataView.getUint16(tiffOffset+2,littleEndian)&&(firstIFDOffset=dataView.getUint32(tiffOffset+4,littleEndian),firstIFDOffset>=8&&(ifdStart=tiffOffset+firstIFDOffset)))),ifdStart)for(length=dataView.getUint16(ifdStart,littleEndian),i=0;length>i;i++)if(offset=ifdStart+12*i+2,274===dataView.getUint16(offset,littleEndian)){offset+=8,orientation=dataView.getUint16(offset,littleEndian),IS_SAFARI_OR_UIWEBVIEW&&dataView.setUint16(offset,1,littleEndian);break}return orientation}function dataURLToArrayBuffer(dataURL){var i,base64=dataURL.replace(REGEXP_DATA_URL_HEAD,""),binary=atob(base64),length=binary.length,arrayBuffer=new ArrayBuffer(length),dataView=new Uint8Array(arrayBuffer);for(i=0;length>i;i++)dataView[i]=binary.charCodeAt(i);return arrayBuffer}function arrayBufferToDataURL(arrayBuffer){var i,dataView=new Uint8Array(arrayBuffer),length=dataView.length,base64="";for(i=0;length>i;i++)base64+=fromCharCode(dataView[i]);return"data:image/jpeg;base64,"+btoa(base64)}function Cropper(element,options){this.$element=$(element),this.options=$.extend({},Cropper.DEFAULTS,$.isPlainObject(options)&&options),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.wheeling=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var $window=$(window),$document=$(document),location=window.location,navigator=window.navigator,ArrayBuffer=window.ArrayBuffer,Uint8Array=window.Uint8Array,DataView=window.DataView,btoa=window.btoa,NAMESPACE="cropper",CLASS_MODAL="cropper-modal",CLASS_HIDE="cropper-hide",CLASS_HIDDEN="cropper-hidden",CLASS_INVISIBLE="cropper-invisible",CLASS_MOVE="cropper-move",CLASS_CROP="cropper-crop",CLASS_DISABLED="cropper-disabled",CLASS_BG="cropper-bg",EVENT_MOUSE_DOWN="mousedown touchstart pointerdown MSPointerDown",EVENT_MOUSE_MOVE="mousemove touchmove pointermove MSPointerMove",EVENT_MOUSE_UP="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",EVENT_WHEEL="wheel mousewheel DOMMouseScroll",EVENT_DBLCLICK="dblclick",EVENT_LOAD="load."+NAMESPACE,EVENT_ERROR="error."+NAMESPACE,EVENT_RESIZE="resize."+NAMESPACE,EVENT_BUILD="build."+NAMESPACE,EVENT_BUILT="built."+NAMESPACE,EVENT_CROP_START="cropstart."+NAMESPACE,EVENT_CROP_MOVE="cropmove."+NAMESPACE,EVENT_CROP_END="cropend."+NAMESPACE,EVENT_CROP="crop."+NAMESPACE,EVENT_ZOOM="zoom."+NAMESPACE,REGEXP_ACTIONS=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,REGEXP_DATA_URL=/^data:/,REGEXP_DATA_URL_HEAD=/^data:([^;]+);base64,/,REGEXP_DATA_URL_JPEG=/^data:image\/jpeg.*;base64,/,DATA_PREVIEW="preview",DATA_ACTION="action",ACTION_EAST="e",ACTION_WEST="w",ACTION_SOUTH="s",ACTION_NORTH="n",ACTION_SOUTH_EAST="se",ACTION_SOUTH_WEST="sw",ACTION_NORTH_EAST="ne",ACTION_NORTH_WEST="nw",ACTION_ALL="all",ACTION_CROP="crop",ACTION_MOVE="move",ACTION_ZOOM="zoom",ACTION_NONE="none",SUPPORT_CANVAS=$.isFunction($("<canvas>")[0].getContext),IS_SAFARI_OR_UIWEBVIEW=navigator&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent),num=Number,min=Math.min,max=Math.max,abs=Math.abs,sin=Math.sin,cos=Math.cos,sqrt=Math.sqrt,round=Math.round,floor=Math.floor,fromCharCode=String.fromCharCode;Cropper.prototype={constructor:Cropper,init:function(){var url,$this=this.$element;if($this.is("img")){if(this.isImg=!0,this.originalUrl=url=$this.attr("src"),!url)return;url=$this.prop("src")}else $this.is("canvas")&&SUPPORT_CANVAS&&(url=$this[0].toDataURL());this.load(url)},trigger:function(type,data){var e=$.Event(type,data);return this.$element.trigger(e),e},load:function(url){var read,xhr,options=this.options,$this=this.$element;if(url&&($this.one(EVENT_BUILD,options.build),!this.trigger(EVENT_BUILD).isDefaultPrevented())){if(this.url=url,this.image={},!options.checkOrientation||!ArrayBuffer)return this.clone();if(read=$.proxy(this.read,this),REGEXP_DATA_URL.test(url))return REGEXP_DATA_URL_JPEG.test(url)?read(dataURLToArrayBuffer(url)):this.clone();xhr=new XMLHttpRequest,xhr.onerror=xhr.onabort=$.proxy(function(){this.clone()},this),xhr.onload=function(){read(this.response)},options.checkCrossOrigin&&isCrossOriginURL(url)&&$this.prop("crossOrigin")&&(url=addTimestamp(url)),xhr.open("get",url),xhr.responseType="arraybuffer",xhr.send()}},read:function(arrayBuffer){var options=this.options,orientation=getOrientation(arrayBuffer),image=this.image,rotate=0,scaleX=1,scaleY=1;if(orientation>1)switch(this.url=arrayBufferToDataURL(arrayBuffer),orientation){case 2:scaleX=-1;break;case 3:rotate=-180;break;case 4:scaleY=-1;break;case 5:rotate=90,scaleY=-1;break;case 6:rotate=90;break;case 7:rotate=90,scaleX=-1;break;case 8:rotate=-90}options.rotatable&&(image.rotate=rotate),options.scalable&&(image.scaleX=scaleX,image.scaleY=scaleY),this.clone()},clone:function(){var crossOriginUrl,$clone,options=this.options,$this=this.$element,url=this.url,crossOrigin="";options.checkCrossOrigin&&isCrossOriginURL(url)&&(crossOrigin=$this.prop("crossOrigin"),crossOrigin?crossOriginUrl=url:(crossOrigin="anonymous",crossOriginUrl=addTimestamp(url))),this.crossOrigin=crossOrigin,this.crossOriginUrl=crossOriginUrl,this.$clone=$clone=$("<img"+getCrossOrigin(crossOrigin)+' src="'+(crossOriginUrl||url)+'">'),this.isImg?$this[0].complete?this.start():$this.one(EVENT_LOAD,$.proxy(this.start,this)):$clone.one(EVENT_LOAD,$.proxy(this.start,this)).one(EVENT_ERROR,$.proxy(this.stop,this)).addClass(CLASS_HIDE).insertAfter($this)},start:function(){var $image=this.$element,$clone=this.$clone;this.isImg||($clone.off(EVENT_ERROR,this.stop),$image=$clone),getImageSize($image[0],$.proxy(function(naturalWidth,naturalHeight){$.extend(this.image,{naturalWidth:naturalWidth,naturalHeight:naturalHeight,aspectRatio:naturalWidth/naturalHeight}),this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null},build:function(){var $cropper,$cropBox,$face,options=this.options,$this=this.$element,$clone=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=$this.parent(),this.$cropper=$cropper=$(Cropper.TEMPLATE),this.$canvas=$cropper.find(".cropper-canvas").append($clone),this.$dragBox=$cropper.find(".cropper-drag-box"),this.$cropBox=$cropBox=$cropper.find(".cropper-crop-box"),this.$viewBox=$cropper.find(".cropper-view-box"),this.$face=$face=$cropBox.find(".cropper-face"),$this.addClass(CLASS_HIDDEN).after($cropper),this.isImg||$clone.removeClass(CLASS_HIDE),this.initPreview(),this.bind(),options.aspectRatio=max(0,options.aspectRatio)||NaN,options.viewMode=max(0,min(3,round(options.viewMode)))||0,options.autoCrop?(this.isCropped=!0,options.modal&&this.$dragBox.addClass(CLASS_MODAL)):$cropBox.addClass(CLASS_HIDDEN),options.guides||$cropBox.find(".cropper-dashed").addClass(CLASS_HIDDEN),options.center||$cropBox.find(".cropper-center").addClass(CLASS_HIDDEN),options.cropBoxMovable&&$face.addClass(CLASS_MOVE).data(DATA_ACTION,ACTION_ALL),options.highlight||$face.addClass(CLASS_INVISIBLE),options.background&&$cropper.addClass(CLASS_BG),options.cropBoxResizable||$cropBox.find(".cropper-line, .cropper-point").addClass(CLASS_HIDDEN),this.setDragMode(options.dragMode),this.render(),this.isBuilt=!0,
this.setData(options.data),$this.one(EVENT_BUILT,options.built),this.completing=setTimeout($.proxy(function(){this.trigger(EVENT_BUILT),this.trigger(EVENT_CROP,this.getData()),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isCompleted||clearTimeout(this.completing),this.isBuilt=!1,this.isCompleted=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var options=this.options,$this=this.$element,$container=this.$container,$cropper=this.$cropper;$cropper.addClass(CLASS_HIDDEN),$this.removeClass(CLASS_HIDDEN),$cropper.css(this.container={width:max($container.width(),num(options.minContainerWidth)||200),height:max($container.height(),num(options.minContainerHeight)||100)}),$this.addClass(CLASS_HIDDEN),$cropper.removeClass(CLASS_HIDDEN)},initCanvas:function(){var canvas,viewMode=this.options.viewMode,container=this.container,containerWidth=container.width,containerHeight=container.height,image=this.image,imageNaturalWidth=image.naturalWidth,imageNaturalHeight=image.naturalHeight,is90Degree=90===abs(image.rotate),naturalWidth=is90Degree?imageNaturalHeight:imageNaturalWidth,naturalHeight=is90Degree?imageNaturalWidth:imageNaturalHeight,aspectRatio=naturalWidth/naturalHeight,canvasWidth=containerWidth,canvasHeight=containerHeight;containerHeight*aspectRatio>containerWidth?3===viewMode?canvasWidth=containerHeight*aspectRatio:canvasHeight=containerWidth/aspectRatio:3===viewMode?canvasHeight=containerWidth/aspectRatio:canvasWidth=containerHeight*aspectRatio,canvas={naturalWidth:naturalWidth,naturalHeight:naturalHeight,aspectRatio:aspectRatio,width:canvasWidth,height:canvasHeight},canvas.oldLeft=canvas.left=(containerWidth-canvasWidth)/2,canvas.oldTop=canvas.top=(containerHeight-canvasHeight)/2,this.canvas=canvas,this.isLimited=1===viewMode||2===viewMode,this.limitCanvas(!0,!0),this.initialImage=$.extend({},image),this.initialCanvas=$.extend({},canvas)},limitCanvas:function(isSizeLimited,isPositionLimited){var minCanvasWidth,minCanvasHeight,newCanvasLeft,newCanvasTop,options=this.options,viewMode=options.viewMode,container=this.container,containerWidth=container.width,containerHeight=container.height,canvas=this.canvas,aspectRatio=canvas.aspectRatio,cropBox=this.cropBox,isCropped=this.isCropped&&cropBox;isSizeLimited&&(minCanvasWidth=num(options.minCanvasWidth)||0,minCanvasHeight=num(options.minCanvasHeight)||0,viewMode&&(viewMode>1?(minCanvasWidth=max(minCanvasWidth,containerWidth),minCanvasHeight=max(minCanvasHeight,containerHeight),3===viewMode&&(minCanvasHeight*aspectRatio>minCanvasWidth?minCanvasWidth=minCanvasHeight*aspectRatio:minCanvasHeight=minCanvasWidth/aspectRatio)):minCanvasWidth?minCanvasWidth=max(minCanvasWidth,isCropped?cropBox.width:0):minCanvasHeight?minCanvasHeight=max(minCanvasHeight,isCropped?cropBox.height:0):isCropped&&(minCanvasWidth=cropBox.width,minCanvasHeight=cropBox.height,minCanvasHeight*aspectRatio>minCanvasWidth?minCanvasWidth=minCanvasHeight*aspectRatio:minCanvasHeight=minCanvasWidth/aspectRatio)),minCanvasWidth&&minCanvasHeight?minCanvasHeight*aspectRatio>minCanvasWidth?minCanvasHeight=minCanvasWidth/aspectRatio:minCanvasWidth=minCanvasHeight*aspectRatio:minCanvasWidth?minCanvasHeight=minCanvasWidth/aspectRatio:minCanvasHeight&&(minCanvasWidth=minCanvasHeight*aspectRatio),canvas.minWidth=minCanvasWidth,canvas.minHeight=minCanvasHeight,canvas.maxWidth=1/0,canvas.maxHeight=1/0),isPositionLimited&&(viewMode?(newCanvasLeft=containerWidth-canvas.width,newCanvasTop=containerHeight-canvas.height,canvas.minLeft=min(0,newCanvasLeft),canvas.minTop=min(0,newCanvasTop),canvas.maxLeft=max(0,newCanvasLeft),canvas.maxTop=max(0,newCanvasTop),isCropped&&this.isLimited&&(canvas.minLeft=min(cropBox.left,cropBox.left+cropBox.width-canvas.width),canvas.minTop=min(cropBox.top,cropBox.top+cropBox.height-canvas.height),canvas.maxLeft=cropBox.left,canvas.maxTop=cropBox.top,2===viewMode&&(canvas.width>=containerWidth&&(canvas.minLeft=min(0,newCanvasLeft),canvas.maxLeft=max(0,newCanvasLeft)),canvas.height>=containerHeight&&(canvas.minTop=min(0,newCanvasTop),canvas.maxTop=max(0,newCanvasTop))))):(canvas.minLeft=-canvas.width,canvas.minTop=-canvas.height,canvas.maxLeft=containerWidth,canvas.maxTop=containerHeight))},renderCanvas:function(isChanged){var aspectRatio,rotated,canvas=this.canvas,image=this.image,rotate=image.rotate,naturalWidth=image.naturalWidth,naturalHeight=image.naturalHeight;this.isRotated&&(this.isRotated=!1,rotated=getRotatedSizes({width:image.width,height:image.height,degree:rotate}),aspectRatio=rotated.width/rotated.height,aspectRatio!==canvas.aspectRatio&&(canvas.left-=(rotated.width-canvas.width)/2,canvas.top-=(rotated.height-canvas.height)/2,canvas.width=rotated.width,canvas.height=rotated.height,canvas.aspectRatio=aspectRatio,canvas.naturalWidth=naturalWidth,canvas.naturalHeight=naturalHeight,rotate%180&&(rotated=getRotatedSizes({width:naturalWidth,height:naturalHeight,degree:rotate}),canvas.naturalWidth=rotated.width,canvas.naturalHeight=rotated.height),this.limitCanvas(!0,!1))),(canvas.width>canvas.maxWidth||canvas.width<canvas.minWidth)&&(canvas.left=canvas.oldLeft),(canvas.height>canvas.maxHeight||canvas.height<canvas.minHeight)&&(canvas.top=canvas.oldTop),canvas.width=min(max(canvas.width,canvas.minWidth),canvas.maxWidth),canvas.height=min(max(canvas.height,canvas.minHeight),canvas.maxHeight),this.limitCanvas(!1,!0),canvas.oldLeft=canvas.left=min(max(canvas.left,canvas.minLeft),canvas.maxLeft),canvas.oldTop=canvas.top=min(max(canvas.top,canvas.minTop),canvas.maxTop),this.$canvas.css({width:canvas.width,height:canvas.height,left:canvas.left,top:canvas.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),isChanged&&this.output()},renderImage:function(isChanged){var reversed,canvas=this.canvas,image=this.image;image.rotate&&(reversed=getRotatedSizes({width:canvas.width,height:canvas.height,degree:image.rotate,aspectRatio:image.aspectRatio},!0)),$.extend(image,reversed?{width:reversed.width,height:reversed.height,left:(canvas.width-reversed.width)/2,top:(canvas.height-reversed.height)/2}:{width:canvas.width,height:canvas.height,left:0,top:0}),this.$clone.css({width:image.width,height:image.height,marginLeft:image.left,marginTop:image.top,transform:getTransform(image)}),isChanged&&this.output()},initCropBox:function(){var options=this.options,canvas=this.canvas,aspectRatio=options.aspectRatio,autoCropArea=num(options.autoCropArea)||.8,cropBox={width:canvas.width,height:canvas.height};aspectRatio&&(canvas.height*aspectRatio>canvas.width?cropBox.height=cropBox.width/aspectRatio:cropBox.width=cropBox.height*aspectRatio),this.cropBox=cropBox,this.limitCropBox(!0,!0),cropBox.width=min(max(cropBox.width,cropBox.minWidth),cropBox.maxWidth),cropBox.height=min(max(cropBox.height,cropBox.minHeight),cropBox.maxHeight),cropBox.width=max(cropBox.minWidth,cropBox.width*autoCropArea),cropBox.height=max(cropBox.minHeight,cropBox.height*autoCropArea),cropBox.oldLeft=cropBox.left=canvas.left+(canvas.width-cropBox.width)/2,cropBox.oldTop=cropBox.top=canvas.top+(canvas.height-cropBox.height)/2,this.initialCropBox=$.extend({},cropBox)},limitCropBox:function(isSizeLimited,isPositionLimited){var minCropBoxWidth,minCropBoxHeight,maxCropBoxWidth,maxCropBoxHeight,options=this.options,aspectRatio=options.aspectRatio,container=this.container,containerWidth=container.width,containerHeight=container.height,canvas=this.canvas,cropBox=this.cropBox,isLimited=this.isLimited;isSizeLimited&&(minCropBoxWidth=num(options.minCropBoxWidth)||0,minCropBoxHeight=num(options.minCropBoxHeight)||0,minCropBoxWidth=min(minCropBoxWidth,containerWidth),minCropBoxHeight=min(minCropBoxHeight,containerHeight),maxCropBoxWidth=min(containerWidth,isLimited?canvas.width:containerWidth),maxCropBoxHeight=min(containerHeight,isLimited?canvas.height:containerHeight),aspectRatio&&(minCropBoxWidth&&minCropBoxHeight?minCropBoxHeight*aspectRatio>minCropBoxWidth?minCropBoxHeight=minCropBoxWidth/aspectRatio:minCropBoxWidth=minCropBoxHeight*aspectRatio:minCropBoxWidth?minCropBoxHeight=minCropBoxWidth/aspectRatio:minCropBoxHeight&&(minCropBoxWidth=minCropBoxHeight*aspectRatio),maxCropBoxHeight*aspectRatio>maxCropBoxWidth?maxCropBoxHeight=maxCropBoxWidth/aspectRatio:maxCropBoxWidth=maxCropBoxHeight*aspectRatio),cropBox.minWidth=min(minCropBoxWidth,maxCropBoxWidth),cropBox.minHeight=min(minCropBoxHeight,maxCropBoxHeight),cropBox.maxWidth=maxCropBoxWidth,cropBox.maxHeight=maxCropBoxHeight),isPositionLimited&&(isLimited?(cropBox.minLeft=max(0,canvas.left),cropBox.minTop=max(0,canvas.top),cropBox.maxLeft=min(containerWidth,canvas.left+canvas.width)-cropBox.width,cropBox.maxTop=min(containerHeight,canvas.top+canvas.height)-cropBox.height):(cropBox.minLeft=0,cropBox.minTop=0,cropBox.maxLeft=containerWidth-cropBox.width,cropBox.maxTop=containerHeight-cropBox.height))},renderCropBox:function(){var options=this.options,container=this.container,containerWidth=container.width,containerHeight=container.height,cropBox=this.cropBox;(cropBox.width>cropBox.maxWidth||cropBox.width<cropBox.minWidth)&&(cropBox.left=cropBox.oldLeft),(cropBox.height>cropBox.maxHeight||cropBox.height<cropBox.minHeight)&&(cropBox.top=cropBox.oldTop),cropBox.width=min(max(cropBox.width,cropBox.minWidth),cropBox.maxWidth),cropBox.height=min(max(cropBox.height,cropBox.minHeight),cropBox.maxHeight),this.limitCropBox(!1,!0),cropBox.oldLeft=cropBox.left=min(max(cropBox.left,cropBox.minLeft),cropBox.maxLeft),cropBox.oldTop=cropBox.top=min(max(cropBox.top,cropBox.minTop),cropBox.maxTop),options.movable&&options.cropBoxMovable&&this.$face.data(DATA_ACTION,cropBox.width===containerWidth&&cropBox.height===containerHeight?ACTION_MOVE:ACTION_ALL),this.$cropBox.css({width:cropBox.width,height:cropBox.height,left:cropBox.left,top:cropBox.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted&&this.trigger(EVENT_CROP,this.getData())},initPreview:function(){var $clone2,crossOrigin=getCrossOrigin(this.crossOrigin),url=crossOrigin?this.crossOriginUrl:this.url;this.$preview=$(this.options.preview),this.$clone2=$clone2=$("<img"+crossOrigin+' src="'+url+'">'),this.$viewBox.html($clone2),this.$preview.each(function(){var $this=$(this);$this.data(DATA_PREVIEW,{width:$this.width(),height:$this.height(),html:$this.html()}),$this.html("<img"+crossOrigin+' src="'+url+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(){var $this=$(this),data=$this.data(DATA_PREVIEW);$this.css({width:data.width,height:data.height}).html(data.html).removeData(DATA_PREVIEW)})},preview:function(){var image=this.image,canvas=this.canvas,cropBox=this.cropBox,cropBoxWidth=cropBox.width,cropBoxHeight=cropBox.height,width=image.width,height=image.height,left=cropBox.left-canvas.left-image.left,top=cropBox.top-canvas.top-image.top;this.isCropped&&!this.isDisabled&&(this.$clone2.css({width:width,height:height,marginLeft:-left,marginTop:-top,transform:getTransform(image)}),this.$preview.each(function(){var $this=$(this),data=$this.data(DATA_PREVIEW),originalWidth=data.width,originalHeight=data.height,newWidth=originalWidth,newHeight=originalHeight,ratio=1;cropBoxWidth&&(ratio=originalWidth/cropBoxWidth,newHeight=cropBoxHeight*ratio),cropBoxHeight&&newHeight>originalHeight&&(ratio=originalHeight/cropBoxHeight,newWidth=cropBoxWidth*ratio,newHeight=originalHeight),$this.css({width:newWidth,height:newHeight}).find("img").css({width:width*ratio,height:height*ratio,marginLeft:-left*ratio,marginTop:-top*ratio,transform:getTransform(image)})}))},bind:function(){var options=this.options,$this=this.$element,$cropper=this.$cropper;$.isFunction(options.cropstart)&&$this.on(EVENT_CROP_START,options.cropstart),$.isFunction(options.cropmove)&&$this.on(EVENT_CROP_MOVE,options.cropmove),$.isFunction(options.cropend)&&$this.on(EVENT_CROP_END,options.cropend),$.isFunction(options.crop)&&$this.on(EVENT_CROP,options.crop),$.isFunction(options.zoom)&&$this.on(EVENT_ZOOM,options.zoom),$cropper.on(EVENT_MOUSE_DOWN,$.proxy(this.cropStart,this)),options.zoomable&&options.zoomOnWheel&&$cropper.on(EVENT_WHEEL,$.proxy(this.wheel,this)),options.toggleDragModeOnDblclick&&$cropper.on(EVENT_DBLCLICK,$.proxy(this.dblclick,this)),$document.on(EVENT_MOUSE_MOVE,this._cropMove=proxy(this.cropMove,this)).on(EVENT_MOUSE_UP,this._cropEnd=proxy(this.cropEnd,this)),options.responsive&&$window.on(EVENT_RESIZE,this._resize=proxy(this.resize,this))},unbind:function(){var options=this.options,$this=this.$element,$cropper=this.$cropper;$.isFunction(options.cropstart)&&$this.off(EVENT_CROP_START,options.cropstart),$.isFunction(options.cropmove)&&$this.off(EVENT_CROP_MOVE,options.cropmove),$.isFunction(options.cropend)&&$this.off(EVENT_CROP_END,options.cropend),$.isFunction(options.crop)&&$this.off(EVENT_CROP,options.crop),$.isFunction(options.zoom)&&$this.off(EVENT_ZOOM,options.zoom),$cropper.off(EVENT_MOUSE_DOWN,this.cropStart),options.zoomable&&options.zoomOnWheel&&$cropper.off(EVENT_WHEEL,this.wheel),options.toggleDragModeOnDblclick&&$cropper.off(EVENT_DBLCLICK,this.dblclick),$document.off(EVENT_MOUSE_MOVE,this._cropMove).off(EVENT_MOUSE_UP,this._cropEnd),options.responsive&&$window.off(EVENT_RESIZE,this._resize)},resize:function(){var canvasData,cropBoxData,ratio,restore=this.options.restore,$container=this.$container,container=this.container;!this.isDisabled&&container&&(ratio=$container.width()/container.width,(1!==ratio||$container.height()!==container.height)&&(restore&&(canvasData=this.getCanvasData(),cropBoxData=this.getCropBoxData()),this.render(),restore&&(this.setCanvasData($.each(canvasData,function(i,n){canvasData[i]=n*ratio})),this.setCropBoxData($.each(cropBoxData,function(i,n){cropBoxData[i]=n*ratio})))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass(CLASS_CROP)?this.setDragMode(ACTION_MOVE):this.setDragMode(ACTION_CROP))},wheel:function(event){var e=event.originalEvent||event,ratio=num(this.options.wheelZoomRatio)||.1,delta=1;this.isDisabled||(event.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout($.proxy(function(){this.wheeling=!1},this),50),e.deltaY?delta=e.deltaY>0?1:-1:e.wheelDelta?delta=-e.wheelDelta/120:e.detail&&(delta=e.detail>0?1:-1),this.zoom(-delta*ratio,event)))},cropStart:function(event){var touchesLength,action,options=this.options,originalEvent=event.originalEvent,touches=originalEvent&&originalEvent.touches,e=event;if(!this.isDisabled){if(touches){if(touchesLength=touches.length,touchesLength>1){if(!options.zoomable||!options.zoomOnTouch||2!==touchesLength)return;e=touches[1],this.startX2=e.pageX,this.startY2=e.pageY,action=ACTION_ZOOM}e=touches[0]}if(action=action||$(e.target).data(DATA_ACTION),REGEXP_ACTIONS.test(action)){if(this.trigger(EVENT_CROP_START,{originalEvent:originalEvent,action:action}).isDefaultPrevented())return;event.preventDefault(),this.action=action,this.cropping=!1,this.startX=e.pageX||originalEvent&&originalEvent.pageX,this.startY=e.pageY||originalEvent&&originalEvent.pageY,action===ACTION_CROP&&(this.cropping=!0,this.$dragBox.addClass(CLASS_MODAL))}}},cropMove:function(event){var touchesLength,options=this.options,originalEvent=event.originalEvent,touches=originalEvent&&originalEvent.touches,e=event,action=this.action;if(!this.isDisabled){if(touches){if(touchesLength=touches.length,touchesLength>1){if(!options.zoomable||!options.zoomOnTouch||2!==touchesLength)return;e=touches[1],this.endX2=e.pageX,this.endY2=e.pageY}e=touches[0]}if(action){if(this.trigger(EVENT_CROP_MOVE,{originalEvent:originalEvent,action:action}).isDefaultPrevented())return;event.preventDefault(),this.endX=e.pageX||originalEvent&&originalEvent.pageX,this.endY=e.pageY||originalEvent&&originalEvent.pageY,this.change(e.shiftKey,action===ACTION_ZOOM?event:null)}}},cropEnd:function(event){var originalEvent=event.originalEvent,action=this.action;this.isDisabled||action&&(event.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(CLASS_MODAL,this.isCropped&&this.options.modal)),this.action="",this.trigger(EVENT_CROP_END,{originalEvent:originalEvent,action:action}))},change:function(shiftKey,event){var offset,range,options=this.options,aspectRatio=options.aspectRatio,action=this.action,container=this.container,canvas=this.canvas,cropBox=this.cropBox,width=cropBox.width,height=cropBox.height,left=cropBox.left,top=cropBox.top,right=left+width,bottom=top+height,minLeft=0,minTop=0,maxWidth=container.width,maxHeight=container.height,renderable=!0;switch(!aspectRatio&&shiftKey&&(aspectRatio=width&&height?width/height:1),this.isLimited&&(minLeft=cropBox.minLeft,minTop=cropBox.minTop,maxWidth=minLeft+min(container.width,canvas.width,canvas.left+canvas.width),maxHeight=minTop+min(container.height,canvas.height,canvas.top+canvas.height)),range={x:this.endX-this.startX,y:this.endY-this.startY},aspectRatio&&(range.X=range.y*aspectRatio,range.Y=range.x/aspectRatio),action){case ACTION_ALL:left+=range.x,top+=range.y;break;case ACTION_EAST:if(range.x>=0&&(right>=maxWidth||aspectRatio&&(minTop>=top||bottom>=maxHeight))){renderable=!1;break}width+=range.x,aspectRatio&&(height=width/aspectRatio,top-=range.Y/2),0>width&&(action=ACTION_WEST,width=0);break;case ACTION_NORTH:if(range.y<=0&&(minTop>=top||aspectRatio&&(minLeft>=left||right>=maxWidth))){renderable=!1;break}height-=range.y,top+=range.y,aspectRatio&&(width=height*aspectRatio,left+=range.X/2),0>height&&(action=ACTION_SOUTH,height=0);break;case ACTION_WEST:if(range.x<=0&&(minLeft>=left||aspectRatio&&(minTop>=top||bottom>=maxHeight))){renderable=!1;break}width-=range.x,left+=range.x,aspectRatio&&(height=width/aspectRatio,top+=range.Y/2),0>width&&(action=ACTION_EAST,width=0);break;case ACTION_SOUTH:if(range.y>=0&&(bottom>=maxHeight||aspectRatio&&(minLeft>=left||right>=maxWidth))){renderable=!1;break}height+=range.y,aspectRatio&&(width=height*aspectRatio,left-=range.X/2),0>height&&(action=ACTION_NORTH,height=0);break;case ACTION_NORTH_EAST:if(aspectRatio){if(range.y<=0&&(minTop>=top||right>=maxWidth)){renderable=!1;break}height-=range.y,top+=range.y,width=height*aspectRatio}else range.x>=0?maxWidth>right?width+=range.x:range.y<=0&&minTop>=top&&(renderable=!1):width+=range.x,range.y<=0?top>minTop&&(height-=range.y,top+=range.y):(height-=range.y,top+=range.y);0>width&&0>height?(action=ACTION_SOUTH_WEST,height=0,width=0):0>width?(action=ACTION_NORTH_WEST,width=0):0>height&&(action=ACTION_SOUTH_EAST,height=0);break;case ACTION_NORTH_WEST:if(aspectRatio){if(range.y<=0&&(minTop>=top||minLeft>=left)){renderable=!1;break}height-=range.y,top+=range.y,width=height*aspectRatio,left+=range.X}else range.x<=0?left>minLeft?(width-=range.x,left+=range.x):range.y<=0&&minTop>=top&&(renderable=!1):(width-=range.x,left+=range.x),range.y<=0?top>minTop&&(height-=range.y,top+=range.y):(height-=range.y,top+=range.y);0>width&&0>height?(action=ACTION_SOUTH_EAST,height=0,width=0):0>width?(action=ACTION_NORTH_EAST,width=0):0>height&&(action=ACTION_SOUTH_WEST,height=0);break;case ACTION_SOUTH_WEST:if(aspectRatio){if(range.x<=0&&(minLeft>=left||bottom>=maxHeight)){renderable=!1;break}width-=range.x,left+=range.x,height=width/aspectRatio}else range.x<=0?left>minLeft?(width-=range.x,left+=range.x):range.y>=0&&bottom>=maxHeight&&(renderable=!1):(width-=range.x,left+=range.x),range.y>=0?maxHeight>bottom&&(height+=range.y):height+=range.y;0>width&&0>height?(action=ACTION_NORTH_EAST,height=0,width=0):0>width?(action=ACTION_SOUTH_EAST,width=0):0>height&&(action=ACTION_NORTH_WEST,height=0);break;case ACTION_SOUTH_EAST:if(aspectRatio){if(range.x>=0&&(right>=maxWidth||bottom>=maxHeight)){renderable=!1;break}width+=range.x,height=width/aspectRatio}else range.x>=0?maxWidth>right?width+=range.x:range.y>=0&&bottom>=maxHeight&&(renderable=!1):width+=range.x,range.y>=0?maxHeight>bottom&&(height+=range.y):height+=range.y;0>width&&0>height?(action=ACTION_NORTH_WEST,height=0,width=0):0>width?(action=ACTION_SOUTH_WEST,width=0):0>height&&(action=ACTION_NORTH_EAST,height=0);break;case ACTION_MOVE:this.move(range.x,range.y),renderable=!1;break;case ACTION_ZOOM:this.zoom(function(x1,y1,x2,y2){var z1=sqrt(x1*x1+y1*y1),z2=sqrt(x2*x2+y2*y2);return(z2-z1)/z1}(abs(this.startX-this.startX2),abs(this.startY-this.startY2),abs(this.endX-this.endX2),abs(this.endY-this.endY2)),event),this.startX2=this.endX2,this.startY2=this.endY2,renderable=!1;break;case ACTION_CROP:if(!range.x||!range.y){renderable=!1;break}offset=this.$cropper.offset(),left=this.startX-offset.left,top=this.startY-offset.top,width=cropBox.minWidth,height=cropBox.minHeight,range.x>0?action=range.y>0?ACTION_SOUTH_EAST:ACTION_NORTH_EAST:range.x<0&&(left-=width,action=range.y>0?ACTION_SOUTH_WEST:ACTION_NORTH_WEST),range.y<0&&(top-=height),this.isCropped||(this.$cropBox.removeClass(CLASS_HIDDEN),this.isCropped=!0,this.isLimited&&this.limitCropBox(!0,!0))}renderable&&(cropBox.width=width,cropBox.height=height,cropBox.left=left,cropBox.top=top,this.action=action,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(CLASS_MODAL),this.$cropBox.removeClass(CLASS_HIDDEN)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=$.extend({},this.initialImage),this.canvas=$.extend({},this.initialCanvas),this.cropBox=$.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&($.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass(CLASS_MODAL),this.$cropBox.addClass(CLASS_HIDDEN))},replace:function(url,onlyColorChanged){!this.isDisabled&&url&&(this.isImg&&this.$element.attr("src",url),onlyColorChanged?(this.url=url,this.$clone.attr("src",url),this.isBuilt&&this.$preview.find("img").add(this.$clone2).attr("src",url)):(this.isImg&&(this.isReplaced=!0),this.options.data=null,this.load(url)))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass(CLASS_DISABLED))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass(CLASS_DISABLED))},destroy:function(){var $this=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&$this.attr("src",this.originalUrl),this.unbuild(),$this.removeClass(CLASS_HIDDEN)):this.isImg?$this.off(EVENT_LOAD,this.start):this.$clone&&this.$clone.remove(),$this.removeData(NAMESPACE)},move:function(offsetX,offsetY){var canvas=this.canvas;this.moveTo(isUndefined(offsetX)?offsetX:canvas.left+num(offsetX),isUndefined(offsetY)?offsetY:canvas.top+num(offsetY))},moveTo:function(x,y){var canvas=this.canvas,isChanged=!1;isUndefined(y)&&(y=x),x=num(x),y=num(y),this.isBuilt&&!this.isDisabled&&this.options.movable&&(isNumber(x)&&(canvas.left=x,isChanged=!0),isNumber(y)&&(canvas.top=y,isChanged=!0),isChanged&&this.renderCanvas(!0))},zoom:function(ratio,_event){var canvas=this.canvas;ratio=num(ratio),ratio=0>ratio?1/(1-ratio):1+ratio,this.zoomTo(canvas.width*ratio/canvas.naturalWidth,_event)},zoomTo:function(ratio,_event){var originalEvent,newWidth,newHeight,offset,center,options=this.options,canvas=this.canvas,width=canvas.width,height=canvas.height,naturalWidth=canvas.naturalWidth,naturalHeight=canvas.naturalHeight;if(ratio=num(ratio),ratio>=0&&this.isBuilt&&!this.isDisabled&&options.zoomable){if(newWidth=naturalWidth*ratio,newHeight=naturalHeight*ratio,_event&&(originalEvent=_event.originalEvent),this.trigger(EVENT_ZOOM,{originalEvent:originalEvent,oldRatio:width/naturalWidth,ratio:newWidth/naturalWidth}).isDefaultPrevented())return;originalEvent?(offset=this.$cropper.offset(),center=originalEvent.touches?getTouchesCenter(originalEvent.touches):{pageX:_event.pageX||originalEvent.pageX||0,pageY:_event.pageY||originalEvent.pageY||0},canvas.left-=(newWidth-width)*((center.pageX-offset.left-canvas.left)/width),canvas.top-=(newHeight-height)*((center.pageY-offset.top-canvas.top)/height)):(canvas.left-=(newWidth-width)/2,canvas.top-=(newHeight-height)/2),canvas.width=newWidth,canvas.height=newHeight,this.renderCanvas(!0)}},rotate:function(degree){this.rotateTo((this.image.rotate||0)+num(degree))},rotateTo:function(degree){degree=num(degree),isNumber(degree)&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=degree%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(scaleX,scaleY){var image=this.image,isChanged=!1;isUndefined(scaleY)&&(scaleY=scaleX),scaleX=num(scaleX),scaleY=num(scaleY),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(isNumber(scaleX)&&(image.scaleX=scaleX,isChanged=!0),isNumber(scaleY)&&(image.scaleY=scaleY,isChanged=!0),isChanged&&this.renderImage(!0))},scaleX:function(scaleX){var scaleY=this.image.scaleY;this.scale(scaleX,isNumber(scaleY)?scaleY:1)},scaleY:function(scaleY){var scaleX=this.image.scaleX;this.scale(isNumber(scaleX)?scaleX:1,scaleY)},getData:function(isRounded){var ratio,data,options=this.options,image=this.image,canvas=this.canvas,cropBox=this.cropBox;return this.isBuilt&&this.isCropped?(data={x:cropBox.left-canvas.left,y:cropBox.top-canvas.top,width:cropBox.width,height:cropBox.height},ratio=image.width/image.naturalWidth,$.each(data,function(i,n){n/=ratio,data[i]=isRounded?round(n):n})):data={x:0,y:0,width:0,height:0},options.rotatable&&(data.rotate=image.rotate||0),options.scalable&&(data.scaleX=image.scaleX||1,data.scaleY=image.scaleY||1),data},setData:function(data){var isRotated,isScaled,ratio,options=this.options,image=this.image,canvas=this.canvas,cropBoxData={};$.isFunction(data)&&(data=data.call(this.element)),this.isBuilt&&!this.isDisabled&&$.isPlainObject(data)&&(options.rotatable&&isNumber(data.rotate)&&data.rotate!==image.rotate&&(image.rotate=data.rotate,this.isRotated=isRotated=!0),options.scalable&&(isNumber(data.scaleX)&&data.scaleX!==image.scaleX&&(image.scaleX=data.scaleX,isScaled=!0),isNumber(data.scaleY)&&data.scaleY!==image.scaleY&&(image.scaleY=data.scaleY,isScaled=!0)),isRotated?this.renderCanvas():isScaled&&this.renderImage(),ratio=image.width/image.naturalWidth,isNumber(data.x)&&(cropBoxData.left=data.x*ratio+canvas.left),isNumber(data.y)&&(cropBoxData.top=data.y*ratio+canvas.top),isNumber(data.width)&&(cropBoxData.width=data.width*ratio),isNumber(data.height)&&(cropBoxData.height=data.height*ratio),this.setCropBoxData(cropBoxData))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var canvas=this.canvas,data={};return this.isBuilt&&$.each(["left","top","width","height","naturalWidth","naturalHeight"],function(i,n){data[n]=canvas[n]}),data},setCanvasData:function(data){var canvas=this.canvas,aspectRatio=canvas.aspectRatio;$.isFunction(data)&&(data=data.call(this.$element)),this.isBuilt&&!this.isDisabled&&$.isPlainObject(data)&&(isNumber(data.left)&&(canvas.left=data.left),isNumber(data.top)&&(canvas.top=data.top),isNumber(data.width)?(canvas.width=data.width,canvas.height=data.width/aspectRatio):isNumber(data.height)&&(canvas.height=data.height,canvas.width=data.height*aspectRatio),this.renderCanvas(!0))},getCropBoxData:function(){var data,cropBox=this.cropBox;return this.isBuilt&&this.isCropped&&(data={left:cropBox.left,top:cropBox.top,width:cropBox.width,height:cropBox.height}),data||{}},setCropBoxData:function(data){var isWidthChanged,isHeightChanged,cropBox=this.cropBox,aspectRatio=this.options.aspectRatio;$.isFunction(data)&&(data=data.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&$.isPlainObject(data)&&(isNumber(data.left)&&(cropBox.left=data.left),isNumber(data.top)&&(cropBox.top=data.top),isNumber(data.width)&&(isWidthChanged=!0,cropBox.width=data.width),isNumber(data.height)&&(isHeightChanged=!0,cropBox.height=data.height),aspectRatio&&(isWidthChanged?cropBox.height=cropBox.width/aspectRatio:isHeightChanged&&(cropBox.width=cropBox.height*aspectRatio)),this.renderCropBox())},getCroppedCanvas:function(options){var originalWidth,originalHeight,canvasWidth,canvasHeight,scaledWidth,scaledHeight,scaledRatio,aspectRatio,canvas,context,data;return this.isBuilt&&SUPPORT_CANVAS?this.isCropped?($.isPlainObject(options)||(options={}),data=this.getData(),originalWidth=data.width,originalHeight=data.height,aspectRatio=originalWidth/originalHeight,$.isPlainObject(options)&&(scaledWidth=options.width,scaledHeight=options.height,scaledWidth?(scaledHeight=scaledWidth/aspectRatio,scaledRatio=scaledWidth/originalWidth):scaledHeight&&(scaledWidth=scaledHeight*aspectRatio,scaledRatio=scaledHeight/originalHeight)),canvasWidth=floor(scaledWidth||originalWidth),canvasHeight=floor(scaledHeight||originalHeight),canvas=$("<canvas>")[0],canvas.width=canvasWidth,canvas.height=canvasHeight,context=canvas.getContext("2d"),options.fillColor&&(context.fillStyle=options.fillColor,context.fillRect(0,0,canvasWidth,canvasHeight)),context.drawImage.apply(context,function(){var srcWidth,srcHeight,dstX,dstY,dstWidth,dstHeight,source=getSourceCanvas(this.$clone[0],this.image),sourceWidth=source.width,sourceHeight=source.height,canvas=this.canvas,params=[source],srcX=data.x+canvas.naturalWidth*(abs(data.scaleX||1)-1)/2,srcY=data.y+canvas.naturalHeight*(abs(data.scaleY||1)-1)/2;return-originalWidth>=srcX||srcX>sourceWidth?srcX=srcWidth=dstX=dstWidth=0:0>=srcX?(dstX=-srcX,srcX=0,srcWidth=dstWidth=min(sourceWidth,originalWidth+srcX)):sourceWidth>=srcX&&(dstX=0,srcWidth=dstWidth=min(originalWidth,sourceWidth-srcX)),0>=srcWidth||-originalHeight>=srcY||srcY>sourceHeight?srcY=srcHeight=dstY=dstHeight=0:0>=srcY?(dstY=-srcY,srcY=0,srcHeight=dstHeight=min(sourceHeight,originalHeight+srcY)):sourceHeight>=srcY&&(dstY=0,srcHeight=dstHeight=min(originalHeight,sourceHeight-srcY)),params.push(floor(srcX),floor(srcY),floor(srcWidth),floor(srcHeight)),scaledRatio&&(dstX*=scaledRatio,dstY*=scaledRatio,dstWidth*=scaledRatio,dstHeight*=scaledRatio),dstWidth>0&&dstHeight>0&&params.push(floor(dstX),floor(dstY),floor(dstWidth),floor(dstHeight)),params}.call(this)),canvas):getSourceCanvas(this.$clone[0],this.image):void 0},setAspectRatio:function(aspectRatio){var options=this.options;this.isDisabled||isUndefined(aspectRatio)||(options.aspectRatio=max(0,aspectRatio)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(mode){var croppable,movable,options=this.options;this.isLoaded&&!this.isDisabled&&(croppable=mode===ACTION_CROP,movable=options.movable&&mode===ACTION_MOVE,mode=croppable||movable?mode:ACTION_NONE,this.$dragBox.data(DATA_ACTION,mode).toggleClass(CLASS_CROP,croppable).toggleClass(CLASS_MOVE,movable),options.cropBoxMovable||this.$face.data(DATA_ACTION,mode).toggleClass(CLASS_CROP,croppable).toggleClass(CLASS_MOVE,movable))}},Cropper.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,
cropend:null,crop:null,zoom:null},Cropper.setDefaults=function(options){$.extend(Cropper.DEFAULTS,options)},Cropper.TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',Cropper.other=$.fn.cropper,$.fn.cropper=function(option){var result,args=toArray(arguments,1);return this.each(function(){var options,fn,$this=$(this),data=$this.data(NAMESPACE);if(!data){if(/destroy/.test(option))return;options=$.extend({},$this.data(),$.isPlainObject(option)&&option),$this.data(NAMESPACE,data=new Cropper(this,options))}"string"==typeof option&&$.isFunction(fn=data[option])&&(result=fn.apply(data,args))}),isUndefined(result)?this:result},$.fn.cropper.Constructor=Cropper,$.fn.cropper.setDefaults=Cropper.setDefaults,$.fn.cropper.noConflict=function(){return $.fn.cropper=Cropper.other,this}});