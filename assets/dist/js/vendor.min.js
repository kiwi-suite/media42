!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["angular-file-upload"]=t():e["angular-file-upload"]=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e["default"]:e},i=r(n(1)),o=r(n(2)),s=r(n(3)),a=r(n(4)),u=r(n(5)),l=r(n(6)),c=r(n(7)),f=r(n(8)),p=r(n(9)),d=r(n(10)),v=r(n(11)),h=r(n(12));angular.module(i.name,[]).value("fileUploaderOptions",o).factory("FileUploader",s).factory("FileLikeObject",a).factory("FileItem",u).factory("FileDirective",l).factory("FileSelect",c).factory("FileDrop",f).factory("FileOver",p).directive("nvFileSelect",d).directive("nvFileDrop",v).directive("nvFileOver",h).run(["FileUploader","FileLikeObject","FileItem","FileDirective","FileSelect","FileDrop","FileOver",function(e,t,n,r,i,o,s){e.FileLikeObject=t,e.FileItem=n,e.FileDirective=r,e.FileSelect=i,e.FileDrop=o,e.FileOver=s}])},function(e,t){e.exports={name:"angularFileUpload"}},function(e,t){"use strict";e.exports={url:"/",alias:"file",headers:{},queue:[],progress:0,autoUpload:!1,removeAfterUpload:!1,method:"POST",filters:[],formData:[],queueLimit:Number.MAX_VALUE,withCredentials:!1}},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e["default"]:e},i=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=(r(n(1)),angular.copy),a=angular.extend,u=angular.forEach,l=angular.isObject,c=angular.isNumber,f=angular.isDefined,p=angular.isArray,d=angular.element;e.exports=function(e,t,n,r,v,h){var m=r.File,g=r.FormData,_=function(){function r(t){o(this,r);var n=s(e);a(this,n,t,{isUploading:!1,_nextIndex:0,_failFilterIndex:-1,_directives:{select:[],drop:[],over:[]}}),this.filters.unshift({name:"queueLimit",fn:this._queueLimitFilter}),this.filters.unshift({name:"folder",fn:this._folderFilter})}return i(r,{addToQueue:{value:function(e,t,n){var r=this,i=this.isArrayLikeObject(e)?e:[e],o=this._getFilters(n),s=this.queue.length,a=[];u(i,function(e){var n=new v(e);if(r._isValidFile(n,o,t)){var i=new h(r,e,t);a.push(i),r.queue.push(i),r._onAfterAddingFile(i)}else{var s=o[r._failFilterIndex];r._onWhenAddingFileFailed(n,s,t)}}),this.queue.length!==s&&(this._onAfterAddingAll(a),this.progress=this._getTotalProgress()),this._render(),this.autoUpload&&this.uploadAll()}},removeFromQueue:{value:function(e){var t=this.getIndexOfItem(e),n=this.queue[t];n.isUploading&&n.cancel(),this.queue.splice(t,1),n._destroy(),this.progress=this._getTotalProgress()}},clearQueue:{value:function(){for(;this.queue.length;)this.queue[0].remove();this.progress=0}},uploadItem:{value:function(e){var t=this.getIndexOfItem(e),n=this.queue[t],r=this.isHTML5?"_xhrTransport":"_iframeTransport";n._prepareToUploading(),this.isUploading||(this.isUploading=!0,this[r](n))}},cancelItem:{value:function(e){var t=this.getIndexOfItem(e),n=this.queue[t],r=this.isHTML5?"_xhr":"_form";n&&n.isUploading&&n[r].abort()}},uploadAll:{value:function(){var e=this.getNotUploadedItems().filter(function(e){return!e.isUploading});e.length&&(u(e,function(e){return e._prepareToUploading()}),e[0].upload())}},cancelAll:{value:function(){var e=this.getNotUploadedItems();u(e,function(e){return e.cancel()})}},isFile:{value:function(e){return this.constructor.isFile(e)}},isFileLikeObject:{value:function(e){return this.constructor.isFileLikeObject(e)}},isArrayLikeObject:{value:function(e){return this.constructor.isArrayLikeObject(e)}},getIndexOfItem:{value:function(e){return c(e)?e:this.queue.indexOf(e)}},getNotUploadedItems:{value:function(){return this.queue.filter(function(e){return!e.isUploaded})}},getReadyItems:{value:function(){return this.queue.filter(function(e){return e.isReady&&!e.isUploading}).sort(function(e,t){return e.index-t.index})}},destroy:{value:function(){var e=this;u(this._directives,function(t){u(e._directives[t],function(e){e.destroy()})})}},onAfterAddingAll:{value:function(e){}},onAfterAddingFile:{value:function(e){}},onWhenAddingFileFailed:{value:function(e,t,n){}},onBeforeUploadItem:{value:function(e){}},onProgressItem:{value:function(e,t){}},onProgressAll:{value:function(e){}},onSuccessItem:{value:function(e,t,n,r){}},onErrorItem:{value:function(e,t,n,r){}},onCancelItem:{value:function(e,t,n,r){}},onCompleteItem:{value:function(e,t,n,r){}},onCompleteAll:{value:function(){}},_getTotalProgress:{value:function(e){if(this.removeAfterUpload)return e||0;var t=this.getNotUploadedItems().length,n=t?this.queue.length-t:this.queue.length,r=100/this.queue.length,i=(e||0)*r/100;return Math.round(n*r+i)}},_getFilters:{value:function(e){if(!e)return this.filters;if(p(e))return e;var t=e.match(/[^\s,]+/g);return this.filters.filter(function(e){return-1!==t.indexOf(e.name)})}},_render:{value:function(){t.$$phase||t.$apply()}},_folderFilter:{value:function(e){return!(!e.size&&!e.type)}},_queueLimitFilter:{value:function(){return this.queue.length<this.queueLimit}},_isValidFile:{value:function(e,t,n){var r=this;return this._failFilterIndex=-1,t.length?t.every(function(t){return r._failFilterIndex++,t.fn.call(r,e,n)}):!0}},_isSuccessCode:{value:function(e){return e>=200&&300>e||304===e}},_transformResponse:{value:function(e,t){var r=this._headersGetter(t);return u(n.defaults.transformResponse,function(t){e=t(e,r)}),e}},_parseHeaders:{value:function(e){var t,n,r,i={};return e?(u(e.split("\n"),function(e){r=e.indexOf(":"),t=e.slice(0,r).trim().toLowerCase(),n=e.slice(r+1).trim(),t&&(i[t]=i[t]?i[t]+", "+n:n)}),i):i}},_headersGetter:{value:function(e){return function(t){return t?e[t.toLowerCase()]||null:e}}},_xhrTransport:{value:function(e){var t=this,n=e._xhr=new XMLHttpRequest,r=new g;if(this._onBeforeUploadItem(e),u(e.formData,function(e){u(e,function(e,t){r.append(t,e)})}),"number"!=typeof e._file.size)throw new TypeError("The file specified is no longer valid");r.append(e.alias,e._file,e.file.name),n.upload.onprogress=function(n){var r=Math.round(n.lengthComputable?100*n.loaded/n.total:0);t._onProgressItem(e,r)},n.onload=function(){var r=t._parseHeaders(n.getAllResponseHeaders()),i=t._transformResponse(n.response,r),o=t._isSuccessCode(n.status)?"Success":"Error",s="_on"+o+"Item";t[s](e,i,n.status,r),t._onCompleteItem(e,i,n.status,r)},n.onerror=function(){var r=t._parseHeaders(n.getAllResponseHeaders()),i=t._transformResponse(n.response,r);t._onErrorItem(e,i,n.status,r),t._onCompleteItem(e,i,n.status,r)},n.onabort=function(){var r=t._parseHeaders(n.getAllResponseHeaders()),i=t._transformResponse(n.response,r);t._onCancelItem(e,i,n.status,r),t._onCompleteItem(e,i,n.status,r)},n.open(e.method,e.url,!0),n.withCredentials=e.withCredentials,u(e.headers,function(e,t){n.setRequestHeader(t,e)}),n.send(r),this._render()}},_iframeTransport:{value:function(e){var t=this,n=d('<form style="display: none;" />'),r=d('<iframe name="iframeTransport'+Date.now()+'">'),i=e._input;e._form&&e._form.replaceWith(i),e._form=n,this._onBeforeUploadItem(e),i.prop("name",e.alias),u(e.formData,function(e){u(e,function(e,t){var r=d('<input type="hidden" name="'+t+'" />');r.val(e),n.append(r)})}),n.prop({action:e.url,method:"POST",target:r.prop("name"),enctype:"multipart/form-data",encoding:"multipart/form-data"}),r.bind("load",function(){var n="",i=200;try{n=r[0].contentDocument.body.innerHTML}catch(o){i=500}var s={response:n,status:i,dummy:!0},a={},u=t._transformResponse(s.response,a);t._onSuccessItem(e,u,s.status,a),t._onCompleteItem(e,u,s.status,a)}),n.abort=function(){var o,s={status:0,dummy:!0},a={};r.unbind("load").prop("src","javascript:false;"),n.replaceWith(i),t._onCancelItem(e,o,s.status,a),t._onCompleteItem(e,o,s.status,a)},i.after(n),n.append(i).append(r),n[0].submit(),this._render()}},_onWhenAddingFileFailed:{value:function(e,t,n){this.onWhenAddingFileFailed(e,t,n)}},_onAfterAddingFile:{value:function(e){this.onAfterAddingFile(e)}},_onAfterAddingAll:{value:function(e){this.onAfterAddingAll(e)}},_onBeforeUploadItem:{value:function(e){e._onBeforeUpload(),this.onBeforeUploadItem(e)}},_onProgressItem:{value:function(e,t){var n=this._getTotalProgress(t);this.progress=n,e._onProgress(t),this.onProgressItem(e,t),this.onProgressAll(n),this._render()}},_onSuccessItem:{value:function(e,t,n,r){e._onSuccess(t,n,r),this.onSuccessItem(e,t,n,r)}},_onErrorItem:{value:function(e,t,n,r){e._onError(t,n,r),this.onErrorItem(e,t,n,r)}},_onCancelItem:{value:function(e,t,n,r){e._onCancel(t,n,r),this.onCancelItem(e,t,n,r)}},_onCompleteItem:{value:function(e,t,n,r){e._onComplete(t,n,r),this.onCompleteItem(e,t,n,r);var i=this.getReadyItems()[0];return this.isUploading=!1,f(i)?void i.upload():(this.onCompleteAll(),this.progress=this._getTotalProgress(),void this._render())}}},{isFile:{value:function(e){return m&&e instanceof m}},isFileLikeObject:{value:function(e){return e instanceof v}},isArrayLikeObject:{value:function(e){return l(e)&&"length"in e}},inherit:{value:function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.super_=t}}}),r}();return _.prototype.isHTML5=!(!m||!g),_.isHTML5=_.prototype.isHTML5,_},e.exports.$inject=["fileUploaderOptions","$rootScope","$http","$window","FileLikeObject","FileItem"]},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e["default"]:e},i=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=(r(n(1)),angular.copy),a=angular.isElement,u=angular.isString;e.exports=function(){var e=function(){function e(t){o(this,e);var n=a(t),r=n?t.value:t,i=u(r)?"FakePath":"Object",s="_createFrom"+i;this[s](r)}return i(e,{_createFromFakePath:{value:function(e){this.lastModifiedDate=null,this.size=null,this.type="like/"+e.slice(e.lastIndexOf(".")+1).toLowerCase(),this.name=e.slice(e.lastIndexOf("/")+e.lastIndexOf("\\")+2)}},_createFromObject:{value:function(e){this.lastModifiedDate=s(e.lastModifiedDate),this.size=e.size,this.type=e.type,this.name=e.name}}}),e}();return e},e.exports.$inject=[]},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e["default"]:e},i=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=(r(n(1)),angular.copy),a=angular.extend,u=angular.element,l=angular.isElement;e.exports=function(e,t){var n=function(){function n(e,r,i){o(this,n);var c=l(r),f=c?u(r):null,p=c?null:r;a(this,{url:e.url,alias:e.alias,headers:s(e.headers),formData:s(e.formData),removeAfterUpload:e.removeAfterUpload,withCredentials:e.withCredentials,method:e.method},i,{uploader:e,file:new t(r),isReady:!1,isUploading:!1,isUploaded:!1,isSuccess:!1,isCancel:!1,isError:!1,progress:0,index:null,_file:p,_input:f}),f&&this._replaceNode(f)}return i(n,{upload:{value:function(){try{this.uploader.uploadItem(this)}catch(e){this.uploader._onCompleteItem(this,"",0,[]),this.uploader._onErrorItem(this,"",0,[])}}},cancel:{value:function(){this.uploader.cancelItem(this)}},remove:{value:function(){this.uploader.removeFromQueue(this)}},onBeforeUpload:{value:function(){}},onProgress:{value:function(e){}},onSuccess:{value:function(e,t,n){}},onError:{value:function(e,t,n){}},onCancel:{value:function(e,t,n){}},onComplete:{value:function(e,t,n){}},_onBeforeUpload:{value:function(){this.isReady=!0,this.isUploading=!0,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!1,this.isError=!1,this.progress=0,this.onBeforeUpload()}},_onProgress:{value:function(e){this.progress=e,this.onProgress(e)}},_onSuccess:{value:function(e,t,n){this.isReady=!1,this.isUploading=!1,this.isUploaded=!0,this.isSuccess=!0,this.isCancel=!1,this.isError=!1,this.progress=100,this.index=null,this.onSuccess(e,t,n)}},_onError:{value:function(e,t,n){this.isReady=!1,this.isUploading=!1,this.isUploaded=!0,this.isSuccess=!1,this.isCancel=!1,this.isError=!0,this.progress=0,this.index=null,this.onError(e,t,n)}},_onCancel:{value:function(e,t,n){this.isReady=!1,this.isUploading=!1,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!0,this.isError=!1,this.progress=0,this.index=null,this.onCancel(e,t,n)}},_onComplete:{value:function(e,t,n){this.onComplete(e,t,n),this.removeAfterUpload&&this.remove()}},_destroy:{value:function(){this._input&&this._input.remove(),this._form&&this._form.remove(),delete this._form,delete this._input}},_prepareToUploading:{value:function(){this.index=this.index||++this.uploader._nextIndex,this.isReady=!0}},_replaceNode:{value:function(t){var n=e(t.clone())(t.scope());n.prop("value",null),t.css("display","none"),t.after(n)}}}),n}();return n},e.exports.$inject=["$compile","FileLikeObject"]},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e["default"]:e},i=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=(r(n(1)),angular.extend);e.exports=function(){var e=function(){function e(t){o(this,e),s(this,t),this.uploader._directives[this.prop].push(this),this._saveLinks(),this.bind()}return i(e,{bind:{value:function(){for(var e in this.events){var t=this.events[e];this.element.bind(e,this[t])}}},unbind:{value:function(){for(var e in this.events)this.element.unbind(e,this.events[e])}},destroy:{value:function(){var e=this.uploader._directives[this.prop].indexOf(this);this.uploader._directives[this.prop].splice(e,1),this.unbind()}},_saveLinks:{value:function(){for(var e in this.events){var t=this.events[e];this[t]=this[t].bind(this)}}}}),e}();return e.prototype.events={},e},e.exports.$inject=[]},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e["default"]:e},i=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function l(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:l(i,t,n)}if("value"in r&&r.writable)return r.value;var o=r.get;return void 0===o?void 0:o.call(n)},s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},u=(r(n(1)),angular.extend);e.exports=function(e){var t=function(e){function t(e){a(this,t);var n=u(e,{events:{$destroy:"destroy",change:"onChange"},prop:"select"});o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n),this.uploader.isHTML5||this.element.removeAttr("multiple"),this.element.prop("value",null)}return s(t,e),i(t,{getOptions:{value:function(){}},getFilters:{value:function(){}},isEmptyAfterSelection:{value:function(){return!!this.element.attr("multiple")}},onChange:{value:function(){var e=this.uploader.isHTML5?this.element[0].files:this.element[0],t=this.getOptions(),n=this.getFilters();this.uploader.isHTML5||this.destroy(),this.uploader.addToQueue(e,t,n),this.isEmptyAfterSelection()&&(this.element.prop("value",null),this.element.replaceWith(this.element=this.element.clone(!0)))}}}),t}(e);return t},e.exports.$inject=["FileDirective"]},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e["default"]:e},i=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function c(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:c(i,t,n)}if("value"in r&&r.writable)return r.value;var o=r.get;return void 0===o?void 0:o.call(n)},s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},u=(r(n(1)),angular.extend),l=angular.forEach;e.exports=function(e){var t=function(e){function t(e){a(this,t);var n=u(e,{events:{$destroy:"destroy",drop:"onDrop",dragover:"onDragOver",dragleave:"onDragLeave"},prop:"drop"});o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n)}return s(t,e),i(t,{getOptions:{value:function(){}},getFilters:{value:function(){}},onDrop:{value:function(e){var t=this._getTransfer(e);if(t){var n=this.getOptions(),r=this.getFilters();this._preventAndStop(e),l(this.uploader._directives.over,this._removeOverClass,this),this.uploader.addToQueue(t.files,n,r)}}},onDragOver:{value:function(e){var t=this._getTransfer(e);this._haveFiles(t.types)&&(t.dropEffect="copy",this._preventAndStop(e),l(this.uploader._directives.over,this._addOverClass,this))}},onDragLeave:{value:function(e){e.currentTarget!==this.element[0]&&(this._preventAndStop(e),l(this.uploader._directives.over,this._removeOverClass,this))}},_getTransfer:{value:function(e){return e.dataTransfer?e.dataTransfer:e.originalEvent.dataTransfer}},_preventAndStop:{value:function(e){e.preventDefault(),e.stopPropagation()}},_haveFiles:{value:function(e){return e?e.indexOf?-1!==e.indexOf("Files"):e.contains?e.contains("Files"):!1:!1}},_addOverClass:{value:function(e){e.addOverClass()}},_removeOverClass:{value:function(e){e.removeOverClass()}}}),t}(e);return t},e.exports.$inject=["FileDirective"]},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e["default"]:e},i=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function l(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:l(i,t,n)}if("value"in r&&r.writable)return r.value;var o=r.get;return void 0===o?void 0:o.call(n)},s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},u=(r(n(1)),angular.extend);e.exports=function(e){var t=function(e){function t(e){a(this,t);var n=u(e,{events:{$destroy:"destroy"},prop:"over",overClass:"nv-file-over"});o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n)}return s(t,e),i(t,{addOverClass:{value:function(){this.element.addClass(this.getOverClass())}},removeOverClass:{value:function(){this.element.removeClass(this.getOverClass())}},getOverClass:{value:function(){return this.overClass}}}),t}(e);return t},e.exports.$inject=["FileDirective"]},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e["default"]:e};r(n(1)),e.exports=function(e,t,n){return{link:function(r,i,o){var s=r.$eval(o.uploader);if(!(s instanceof t))throw new TypeError('"Uploader" must be an instance of FileUploader');var a=new n({uploader:s,element:i});a.getOptions=e(o.options).bind(a,r),a.getFilters=function(){return o.filters}}}},e.exports.$inject=["$parse","FileUploader","FileSelect"]},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e["default"]:e};r(n(1)),e.exports=function(e,t,n){return{link:function(r,i,o){var s=r.$eval(o.uploader);if(!(s instanceof t))throw new TypeError('"Uploader" must be an instance of FileUploader');if(s.isHTML5){var a=new n({uploader:s,element:i});a.getOptions=e(o.options).bind(a,r),a.getFilters=function(){return o.filters}}}}},e.exports.$inject=["$parse","FileUploader","FileDrop"]},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e["default"]:e};r(n(1)),e.exports=function(e,t){return{link:function(n,r,i){var o=n.$eval(i.uploader);if(!(o instanceof e))throw new TypeError('"Uploader" must be an instance of FileUploader');var s=new t({uploader:o,element:r});s.getOverClass=function(){return i.overClass||s.overClass}}}},e.exports.$inject=["FileUploader","FileOver"]}])}),function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory("object"==typeof exports?require("jquery"):jQuery)}(function($){"use strict";function isNumber(n){return"number"==typeof n&&!isNaN(n)}function isUndefined(n){return"undefined"==typeof n}function toArray(obj,offset){var args=[];return isNumber(offset)&&args.push(offset),args.slice.apply(obj,args)}function proxy(fn,context){var args=toArray(arguments,2);return function(){return fn.apply(context,args.concat(toArray(arguments)))}}function isCrossOriginURL(url){var parts=url.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return parts&&(parts[1]!==location.protocol||parts[2]!==location.hostname||parts[3]!==location.port)}function addTimestamp(url){var timestamp="timestamp="+(new Date).getTime();return url+(-1===url.indexOf("?")?"?":"&")+timestamp}function getRotateValue(degree){return degree?"rotate("+degree+"deg)":"none"}function getRotatedSizes(data,reverse){var newWidth,newHeight,deg=abs(data.degree)%180,arc=(deg>90?180-deg:deg)*Math.PI/180,sinArc=sin(arc),cosArc=cos(arc),width=data.width,height=data.height,aspectRatio=data.aspectRatio;return reverse?(newWidth=width/(cosArc+sinArc/aspectRatio),newHeight=newWidth/aspectRatio):(newWidth=width*cosArc+height*sinArc,newHeight=width*sinArc+height*cosArc),{width:newWidth,height:newHeight}}function getSourceCanvas(image,data){var canvas=$("<canvas>")[0],context=canvas.getContext("2d"),width=data.naturalWidth,height=data.naturalHeight,rotate=data.rotate,rotated=getRotatedSizes({width:width,height:height,degree:rotate});return rotate?(canvas.width=rotated.width,canvas.height=rotated.height,context.save(),context.translate(rotated.width/2,rotated.height/2),context.rotate(rotate*Math.PI/180),context.drawImage(image,-width/2,-height/2,width,height),context.restore()):(canvas.width=width,canvas.height=height,context.drawImage(image,0,0,width,height)),canvas}function Cropper(element,options){this.$element=$(element),this.options=$.extend({},Cropper.DEFAULTS,$.isPlainObject(options)&&options),this.ready=!1,this.built=!1,this.rotated=!1,this.cropped=!1,this.disabled=!1,this.replaced=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var $window=$(window),$document=$(document),location=window.location,CROPPER_NAMESPACE=".cropper",CROPPER_PREVIEW="preview"+CROPPER_NAMESPACE,REGEXP_DRAG_TYPES=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,CLASS_MODAL="cropper-modal",CLASS_HIDE="cropper-hide",CLASS_HIDDEN="cropper-hidden",CLASS_INVISIBLE="cropper-invisible",CLASS_MOVE="cropper-move",CLASS_CROP="cropper-crop",CLASS_DISABLED="cropper-disabled",CLASS_BG="cropper-bg",EVENT_MOUSE_DOWN="mousedown touchstart pointerdown MSPointerDown",EVENT_MOUSE_MOVE="mousemove touchmove pointermove MSPointerMove",EVENT_MOUSE_UP="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",EVENT_WHEEL="wheel mousewheel DOMMouseScroll",EVENT_DBLCLICK="dblclick",EVENT_RESIZE="resize"+CROPPER_NAMESPACE,EVENT_BUILD="build"+CROPPER_NAMESPACE,EVENT_BUILT="built"+CROPPER_NAMESPACE,EVENT_DRAG_START="dragstart"+CROPPER_NAMESPACE,EVENT_DRAG_MOVE="dragmove"+CROPPER_NAMESPACE,EVENT_DRAG_END="dragend"+CROPPER_NAMESPACE,EVENT_ZOOM_IN="zoomin"+CROPPER_NAMESPACE,EVENT_ZOOM_OUT="zoomout"+CROPPER_NAMESPACE,EVENT_CHANGE="change"+CROPPER_NAMESPACE,SUPPORT_CANVAS=$.isFunction($("<canvas>")[0].getContext),sqrt=Math.sqrt,min=Math.min,max=Math.max,abs=Math.abs,sin=Math.sin,cos=Math.cos,num=parseFloat,prototype={};prototype.init=function(){var url,$this=this.$element;if($this.is("img")){if(this.isImg=!0,this.originalUrl=url=$this.attr("src"),!url)return;url=$this.prop("src")}else $this.is("canvas")&&SUPPORT_CANVAS&&(url=$this[0].toDataURL());this.load(url)},prototype.load=function(url){var crossOrigin,bustCacheUrl,buildEvent,$clone,options=this.options,$this=this.$element;url&&(buildEvent=$.Event(EVENT_BUILD),$this.one(EVENT_BUILD,options.build).trigger(buildEvent),buildEvent.isDefaultPrevented()||(options.checkImageOrigin&&isCrossOriginURL(url)&&(crossOrigin=' crossOrigin="anonymous"',$this.prop("crossOrigin")||(bustCacheUrl=addTimestamp(url))),this.$clone=$clone=$("<img"+(crossOrigin||"")+' src="'+(bustCacheUrl||url)+'">'),$clone.one("load",$.proxy(function(){var image=$clone[0],naturalWidth=image.naturalWidth||image.width,naturalHeight=image.naturalHeight||image.height;this.image={naturalWidth:naturalWidth,naturalHeight:naturalHeight,aspectRatio:naturalWidth/naturalHeight,rotate:0},this.url=url,this.ready=!0,this.build()},this)).one("error",function(){$clone.remove()}),$clone.addClass(CLASS_HIDE).insertAfter($this)))},prototype.build=function(){var $cropper,$cropBox,$face,$this=this.$element,$clone=this.$clone,options=this.options;this.ready&&(this.built&&this.unbuild(),this.$cropper=$cropper=$(Cropper.TEMPLATE),$this.addClass(CLASS_HIDDEN),$clone.removeClass(CLASS_HIDE),this.$container=$this.parent().append($cropper),this.$canvas=$cropper.find(".cropper-canvas").append($clone),this.$dragBox=$cropper.find(".cropper-drag-box"),this.$cropBox=$cropBox=$cropper.find(".cropper-crop-box"),this.$viewBox=$cropper.find(".cropper-view-box"),this.$face=$face=$cropBox.find(".cropper-face"),this.addListeners(),this.initPreview(),options.aspectRatio=num(options.aspectRatio)||NaN,options.autoCrop?(this.cropped=!0,options.modal&&this.$dragBox.addClass(CLASS_MODAL)):$cropBox.addClass(CLASS_HIDDEN),options.guides||$cropBox.find(".cropper-dashed").addClass(CLASS_HIDDEN),options.center||$cropBox.find(".cropper-center").addClass(CLASS_HIDDEN),options.cropBoxMovable&&$face.addClass(CLASS_MOVE).data("drag","all"),options.highlight||$face.addClass(CLASS_INVISIBLE),options.background&&$cropper.addClass(CLASS_BG),options.cropBoxResizable||$cropBox.find(".cropper-line, .cropper-point").addClass(CLASS_HIDDEN),this.setDragMode(options.dragCrop?"crop":options.movable?"move":"none"),this.built=!0,this.render(),this.setData(options.data),$this.one(EVENT_BUILT,options.built).trigger(EVENT_BUILT))},prototype.unbuild=function(){this.built&&(this.built=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.removeListeners(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},$.extend(prototype,{render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var $this=this.$element,$container=this.$container,$cropper=this.$cropper,options=this.options;$cropper.addClass(CLASS_HIDDEN),$this.removeClass(CLASS_HIDDEN),$cropper.css(this.container={width:max($container.width(),num(options.minContainerWidth)||200),height:max($container.height(),num(options.minContainerHeight)||100)}),$this.addClass(CLASS_HIDDEN),$cropper.removeClass(CLASS_HIDDEN)},initCanvas:function(){var container=this.container,containerWidth=container.width,containerHeight=container.height,image=this.image,aspectRatio=image.aspectRatio,canvas={aspectRatio:aspectRatio,width:containerWidth,height:containerHeight};containerHeight*aspectRatio>containerWidth?canvas.height=containerWidth/aspectRatio:canvas.width=containerHeight*aspectRatio,canvas.oldLeft=canvas.left=(containerWidth-canvas.width)/2,canvas.oldTop=canvas.top=(containerHeight-canvas.height)/2,this.canvas=canvas,this.limitCanvas(!0,!0),this.initialImage=$.extend({},image),this.initialCanvas=$.extend({},canvas)},limitCanvas:function(size,position){var minCanvasWidth,minCanvasHeight,options=this.options,strict=options.strict,container=this.container,containerWidth=container.width,containerHeight=container.height,canvas=this.canvas,aspectRatio=canvas.aspectRatio,cropBox=this.cropBox,cropped=this.cropped&&cropBox,initialCanvas=this.initialCanvas||canvas,initialCanvasWidth=initialCanvas.width,initialCanvasHeight=initialCanvas.height;size&&(minCanvasWidth=num(options.minCanvasWidth)||0,minCanvasHeight=num(options.minCanvasHeight)||0,minCanvasWidth?(strict&&(minCanvasWidth=max(cropped?cropBox.width:initialCanvasWidth,minCanvasWidth)),minCanvasHeight=minCanvasWidth/aspectRatio):minCanvasHeight?(strict&&(minCanvasHeight=max(cropped?cropBox.height:initialCanvasHeight,minCanvasHeight)),minCanvasWidth=minCanvasHeight*aspectRatio):strict&&(cropped?(minCanvasWidth=cropBox.width,minCanvasHeight=cropBox.height,minCanvasHeight*aspectRatio>minCanvasWidth?minCanvasWidth=minCanvasHeight*aspectRatio:minCanvasHeight=minCanvasWidth/aspectRatio):(minCanvasWidth=initialCanvasWidth,minCanvasHeight=initialCanvasHeight)),$.extend(canvas,{minWidth:minCanvasWidth,minHeight:minCanvasHeight,maxWidth:1/0,maxHeight:1/0})),position&&(strict?cropped?(canvas.minLeft=min(cropBox.left,cropBox.left+cropBox.width-canvas.width),canvas.minTop=min(cropBox.top,cropBox.top+cropBox.height-canvas.height),canvas.maxLeft=cropBox.left,canvas.maxTop=cropBox.top):(canvas.minLeft=min(0,containerWidth-canvas.width),canvas.minTop=min(0,containerHeight-canvas.height),canvas.maxLeft=max(0,containerWidth-canvas.width),canvas.maxTop=max(0,containerHeight-canvas.height)):(canvas.minLeft=-canvas.width,canvas.minTop=-canvas.height,canvas.maxLeft=containerWidth,canvas.maxTop=containerHeight))},renderCanvas:function(changed){var aspectRatio,rotated,options=this.options,canvas=this.canvas,image=this.image;this.rotated&&(this.rotated=!1,rotated=getRotatedSizes({width:image.width,height:image.height,degree:image.rotate}),aspectRatio=rotated.width/rotated.height,aspectRatio!==canvas.aspectRatio&&(canvas.left-=(rotated.width-canvas.width)/2,canvas.top-=(rotated.height-canvas.height)/2,canvas.width=rotated.width,canvas.height=rotated.height,canvas.aspectRatio=aspectRatio,this.limitCanvas(!0,!1))),(canvas.width>canvas.maxWidth||canvas.width<canvas.minWidth)&&(canvas.left=canvas.oldLeft),(canvas.height>canvas.maxHeight||canvas.height<canvas.minHeight)&&(canvas.top=canvas.oldTop),canvas.width=min(max(canvas.width,canvas.minWidth),canvas.maxWidth),canvas.height=min(max(canvas.height,canvas.minHeight),canvas.maxHeight),this.limitCanvas(!1,!0),canvas.oldLeft=canvas.left=min(max(canvas.left,canvas.minLeft),canvas.maxLeft),canvas.oldTop=canvas.top=min(max(canvas.top,canvas.minTop),canvas.maxTop),this.$canvas.css({width:canvas.width,height:canvas.height,left:canvas.left,top:canvas.top}),this.renderImage(),this.cropped&&options.strict&&this.limitCropBox(!0,!0),changed&&this.output()},renderImage:function(){var reversed,canvas=this.canvas,image=this.image;image.rotate&&(reversed=getRotatedSizes({width:canvas.width,height:canvas.height,degree:image.rotate,aspectRatio:image.aspectRatio},!0)),$.extend(image,reversed?{width:reversed.width,height:reversed.height,left:(canvas.width-reversed.width)/2,top:(canvas.height-reversed.height)/2}:{width:canvas.width,height:canvas.height,left:0,
top:0}),this.$clone.css({width:image.width,height:image.height,marginLeft:image.left,marginTop:image.top,transform:getRotateValue(image.rotate)})},initCropBox:function(){var options=this.options,canvas=this.canvas,aspectRatio=options.aspectRatio,autoCropArea=num(options.autoCropArea)||.8,cropBox={width:canvas.width,height:canvas.height};aspectRatio&&(canvas.height*aspectRatio>canvas.width?cropBox.height=cropBox.width/aspectRatio:cropBox.width=cropBox.height*aspectRatio),this.cropBox=cropBox,this.limitCropBox(!0,!0),cropBox.width=min(max(cropBox.width,cropBox.minWidth),cropBox.maxWidth),cropBox.height=min(max(cropBox.height,cropBox.minHeight),cropBox.maxHeight),cropBox.width=max(cropBox.minWidth,cropBox.width*autoCropArea),cropBox.height=max(cropBox.minHeight,cropBox.height*autoCropArea),cropBox.oldLeft=cropBox.left=canvas.left+(canvas.width-cropBox.width)/2,cropBox.oldTop=cropBox.top=canvas.top+(canvas.height-cropBox.height)/2,this.initialCropBox=$.extend({},cropBox)},limitCropBox:function(size,position){var minCropBoxWidth,minCropBoxHeight,options=this.options,strict=options.strict,container=this.container,containerWidth=container.width,containerHeight=container.height,canvas=this.canvas,cropBox=this.cropBox,aspectRatio=options.aspectRatio;size&&(minCropBoxWidth=num(options.minCropBoxWidth)||0,minCropBoxHeight=num(options.minCropBoxHeight)||0,cropBox.minWidth=min(containerWidth,minCropBoxWidth),cropBox.minHeight=min(containerHeight,minCropBoxHeight),cropBox.maxWidth=min(containerWidth,strict?canvas.width:containerWidth),cropBox.maxHeight=min(containerHeight,strict?canvas.height:containerHeight),aspectRatio&&(cropBox.maxHeight*aspectRatio>cropBox.maxWidth?(cropBox.minHeight=cropBox.minWidth/aspectRatio,cropBox.maxHeight=cropBox.maxWidth/aspectRatio):(cropBox.minWidth=cropBox.minHeight*aspectRatio,cropBox.maxWidth=cropBox.maxHeight*aspectRatio)),cropBox.minWidth=min(cropBox.maxWidth,cropBox.minWidth),cropBox.minHeight=min(cropBox.maxHeight,cropBox.minHeight)),position&&(strict?(cropBox.minLeft=max(0,canvas.left),cropBox.minTop=max(0,canvas.top),cropBox.maxLeft=min(containerWidth,canvas.left+canvas.width)-cropBox.width,cropBox.maxTop=min(containerHeight,canvas.top+canvas.height)-cropBox.height):(cropBox.minLeft=0,cropBox.minTop=0,cropBox.maxLeft=containerWidth-cropBox.width,cropBox.maxTop=containerHeight-cropBox.height))},renderCropBox:function(){var options=this.options,container=this.container,containerWidth=container.width,containerHeight=container.height,cropBox=this.cropBox;(cropBox.width>cropBox.maxWidth||cropBox.width<cropBox.minWidth)&&(cropBox.left=cropBox.oldLeft),(cropBox.height>cropBox.maxHeight||cropBox.height<cropBox.minHeight)&&(cropBox.top=cropBox.oldTop),cropBox.width=min(max(cropBox.width,cropBox.minWidth),cropBox.maxWidth),cropBox.height=min(max(cropBox.height,cropBox.minHeight),cropBox.maxHeight),this.limitCropBox(!1,!0),cropBox.oldLeft=cropBox.left=min(max(cropBox.left,cropBox.minLeft),cropBox.maxLeft),cropBox.oldTop=cropBox.top=min(max(cropBox.top,cropBox.minTop),cropBox.maxTop),options.movable&&options.cropBoxMovable&&this.$face.data("drag",cropBox.width===containerWidth&&cropBox.height===containerHeight?"move":"all"),this.$cropBox.css({width:cropBox.width,height:cropBox.height,left:cropBox.left,top:cropBox.top}),this.cropped&&options.strict&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){var options=this.options,$this=this.$element;this.preview(),options.crop&&options.crop.call($this,this.getData()),$this.trigger(EVENT_CHANGE)}}),prototype.initPreview=function(){var url=this.url;this.$preview=$(this.options.preview),this.$viewBox.html('<img src="'+url+'">'),this.$preview.each(function(){var $this=$(this);$this.data(CROPPER_PREVIEW,{width:$this.width(),height:$this.height(),original:$this.html()}).html('<img src="'+url+'" style="display:block;width:100%;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation: 0deg!important">')})},prototype.resetPreview=function(){this.$preview.each(function(){var $this=$(this);$this.html($this.data(CROPPER_PREVIEW).original).removeData(CROPPER_PREVIEW)})},prototype.preview=function(){var image=this.image,canvas=this.canvas,cropBox=this.cropBox,width=image.width,height=image.height,left=cropBox.left-canvas.left-image.left,top=cropBox.top-canvas.top-image.top,rotate=image.rotate;this.cropped&&!this.disabled&&(this.$viewBox.find("img").css({width:width,height:height,marginLeft:-left,marginTop:-top,transform:getRotateValue(rotate)}),this.$preview.each(function(){var $this=$(this),data=$this.data(CROPPER_PREVIEW),ratio=data.width/cropBox.width,newWidth=data.width,newHeight=cropBox.height*ratio;newHeight>data.height&&(ratio=data.height/cropBox.height,newWidth=cropBox.width*ratio,newHeight=data.height),$this.width(newWidth).height(newHeight).find("img").css({width:width*ratio,height:height*ratio,marginLeft:-left*ratio,marginTop:-top*ratio,transform:getRotateValue(rotate)})}))},prototype.addListeners=function(){var options=this.options,$this=this.$element,$cropper=this.$cropper;$.isFunction(options.dragstart)&&$this.on(EVENT_DRAG_START,options.dragstart),$.isFunction(options.dragmove)&&$this.on(EVENT_DRAG_MOVE,options.dragmove),$.isFunction(options.dragend)&&$this.on(EVENT_DRAG_END,options.dragend),$.isFunction(options.zoomin)&&$this.on(EVENT_ZOOM_IN,options.zoomin),$.isFunction(options.zoomout)&&$this.on(EVENT_ZOOM_OUT,options.zoomout),$.isFunction(options.change)&&$this.on(EVENT_CHANGE,options.change),$cropper.on(EVENT_MOUSE_DOWN,$.proxy(this.dragstart,this)),options.zoomable&&options.mouseWheelZoom&&$cropper.on(EVENT_WHEEL,$.proxy(this.wheel,this)),options.doubleClickToggle&&$cropper.on(EVENT_DBLCLICK,$.proxy(this.dblclick,this)),$document.on(EVENT_MOUSE_MOVE,this._dragmove=proxy(this.dragmove,this)).on(EVENT_MOUSE_UP,this._dragend=proxy(this.dragend,this)),options.responsive&&$window.on(EVENT_RESIZE,this._resize=proxy(this.resize,this))},prototype.removeListeners=function(){var options=this.options,$this=this.$element,$cropper=this.$cropper;$.isFunction(options.dragstart)&&$this.off(EVENT_DRAG_START,options.dragstart),$.isFunction(options.dragmove)&&$this.off(EVENT_DRAG_MOVE,options.dragmove),$.isFunction(options.dragend)&&$this.off(EVENT_DRAG_END,options.dragend),$.isFunction(options.zoomin)&&$this.off(EVENT_ZOOM_IN,options.zoomin),$.isFunction(options.zoomout)&&$this.off(EVENT_ZOOM_OUT,options.zoomout),$.isFunction(options.change)&&$this.off(EVENT_CHANGE,options.change),$cropper.off(EVENT_MOUSE_DOWN,this.dragstart),options.zoomable&&options.mouseWheelZoom&&$cropper.off(EVENT_WHEEL,this.wheel),options.doubleClickToggle&&$cropper.off(EVENT_DBLCLICK,this.dblclick),$document.off(EVENT_MOUSE_MOVE,this._dragmove).off(EVENT_MOUSE_UP,this._dragend),options.responsive&&$window.off(EVENT_RESIZE,this._resize)},$.extend(prototype,{resize:function(){var canvasData,cropBoxData,ratio,$container=this.$container,container=this.container;!this.disabled&&container&&(ratio=$container.width()/container.width,(1!==ratio||$container.height()!==container.height)&&(canvasData=this.getCanvasData(),cropBoxData=this.getCropBoxData(),this.render(),this.setCanvasData($.each(canvasData,function(i,n){canvasData[i]=n*ratio})),this.setCropBoxData($.each(cropBoxData,function(i,n){cropBoxData[i]=n*ratio}))))},dblclick:function(){this.disabled||(this.$dragBox.hasClass(CLASS_CROP)?this.setDragMode("move"):this.setDragMode("crop"))},wheel:function(event){var e=event.originalEvent,delta=1;this.disabled||(event.preventDefault(),e.deltaY?delta=e.deltaY>0?1:-1:e.wheelDelta?delta=-e.wheelDelta/120:e.detail&&(delta=e.detail>0?1:-1),this.zoom(.1*-delta))},dragstart:function(event){var dragType,dragStartEvent,touchesLength,options=this.options,originalEvent=event.originalEvent,touches=originalEvent&&originalEvent.touches,e=event;if(!this.disabled){if(touches){if(touchesLength=touches.length,touchesLength>1){if(!options.zoomable||!options.touchDragZoom||2!==touchesLength)return;e=touches[1],this.startX2=e.pageX,this.startY2=e.pageY,dragType="zoom"}e=touches[0]}if(dragType=dragType||$(e.target).data("drag"),REGEXP_DRAG_TYPES.test(dragType)){if(event.preventDefault(),dragStartEvent=$.Event(EVENT_DRAG_START,{originalEvent:originalEvent,dragType:dragType}),this.$element.trigger(dragStartEvent),dragStartEvent.isDefaultPrevented())return;this.dragType=dragType,this.cropping=!1,this.startX=e.pageX,this.startY=e.pageY,"crop"===dragType&&(this.cropping=!0,this.$dragBox.addClass(CLASS_MODAL))}}},dragmove:function(event){var dragMoveEvent,touchesLength,options=this.options,originalEvent=event.originalEvent,touches=originalEvent&&originalEvent.touches,e=event,dragType=this.dragType;if(!this.disabled){if(touches){if(touchesLength=touches.length,touchesLength>1){if(!options.zoomable||!options.touchDragZoom||2!==touchesLength)return;e=touches[1],this.endX2=e.pageX,this.endY2=e.pageY}e=touches[0]}if(dragType){if(event.preventDefault(),dragMoveEvent=$.Event(EVENT_DRAG_MOVE,{originalEvent:originalEvent,dragType:dragType}),this.$element.trigger(dragMoveEvent),dragMoveEvent.isDefaultPrevented())return;this.endX=e.pageX,this.endY=e.pageY,this.change(e.shiftKey)}}},dragend:function(event){var dragEndEvent,dragType=this.dragType;if(!this.disabled&&dragType){if(event.preventDefault(),dragEndEvent=$.Event(EVENT_DRAG_END,{originalEvent:event.originalEvent,dragType:dragType}),this.$element.trigger(dragEndEvent),dragEndEvent.isDefaultPrevented())return;this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(CLASS_MODAL,this.cropped&&this.options.modal)),this.dragType=""}}}),$.extend(prototype,{crop:function(){this.built&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(CLASS_MODAL),this.$cropBox.removeClass(CLASS_HIDDEN)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.built&&!this.disabled&&(this.image=$.extend({},this.initialImage),this.canvas=$.extend({},this.initialCanvas),this.cropBox=$.extend({},this.initialCropBox),this.renderCanvas(),this.cropped&&this.renderCropBox())},clear:function(){this.cropped&&!this.disabled&&($.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(),this.renderCanvas(),this.$dragBox.removeClass(CLASS_MODAL),this.$cropBox.addClass(CLASS_HIDDEN))},destroy:function(){var $this=this.$element;this.ready?(this.isImg&&$this.attr("src",this.originalUrl),this.unbuild(),$this.removeClass(CLASS_HIDDEN)):this.$clone&&this.$clone.remove(),$this.removeData("cropper")},replace:function(url){!this.disabled&&url&&(this.isImg&&this.$element.attr("src",url),this.options.data=null,this.load(url))},enable:function(){this.built&&(this.disabled=!1,this.$cropper.removeClass(CLASS_DISABLED))},disable:function(){this.built&&(this.disabled=!0,this.$cropper.addClass(CLASS_DISABLED))},move:function(offsetX,offsetY){var canvas=this.canvas;this.built&&!this.disabled&&this.options.movable&&isNumber(offsetX)&&isNumber(offsetY)&&(canvas.left+=offsetX,canvas.top+=offsetY,this.renderCanvas(!0))},zoom:function(delta){var zoomEvent,width,height,canvas=this.canvas;if(delta=num(delta),delta&&this.built&&!this.disabled&&this.options.zoomable){if(zoomEvent=delta>0?$.Event(EVENT_ZOOM_IN):$.Event(EVENT_ZOOM_OUT),this.$element.trigger(zoomEvent),zoomEvent.isDefaultPrevented())return;delta=-1>=delta?1/(1-delta):1>=delta?1+delta:delta,width=canvas.width*delta,height=canvas.height*delta,canvas.left-=(width-canvas.width)/2,canvas.top-=(height-canvas.height)/2,canvas.width=width,canvas.height=height,this.renderCanvas(!0),this.setDragMode("move")}},rotate:function(degree){var image=this.image;degree=num(degree),degree&&this.built&&!this.disabled&&this.options.rotatable&&(image.rotate=(image.rotate+degree)%360,this.rotated=!0,this.renderCanvas(!0))},getData:function(rounded){var ratio,data,cropBox=this.cropBox,canvas=this.canvas,image=this.image;return this.built&&this.cropped?(data={x:cropBox.left-canvas.left,y:cropBox.top-canvas.top,width:cropBox.width,height:cropBox.height},ratio=image.width/image.naturalWidth,$.each(data,function(i,n){n/=ratio,data[i]=rounded?Math.round(n):n})):data={x:0,y:0,width:0,height:0},data.rotate=this.ready?image.rotate:0,data},setData:function(data){var ratio,image=this.image,canvas=this.canvas,cropBoxData={};this.built&&!this.disabled&&$.isPlainObject(data)&&(isNumber(data.rotate)&&data.rotate!==image.rotate&&this.options.rotatable&&(image.rotate=data.rotate,this.rotated=!0,this.renderCanvas(!0)),ratio=image.width/image.naturalWidth,isNumber(data.x)&&(cropBoxData.left=data.x*ratio+canvas.left),isNumber(data.y)&&(cropBoxData.top=data.y*ratio+canvas.top),isNumber(data.width)&&(cropBoxData.width=data.width*ratio),isNumber(data.height)&&(cropBoxData.height=data.height*ratio),this.setCropBoxData(cropBoxData))},getContainerData:function(){return this.built?this.container:{}},getImageData:function(){return this.ready?this.image:{}},getCanvasData:function(){var data,canvas=this.canvas;return this.built&&(data={left:canvas.left,top:canvas.top,width:canvas.width,height:canvas.height}),data||{}},setCanvasData:function(data){var canvas=this.canvas,aspectRatio=canvas.aspectRatio;this.built&&!this.disabled&&$.isPlainObject(data)&&(isNumber(data.left)&&(canvas.left=data.left),isNumber(data.top)&&(canvas.top=data.top),isNumber(data.width)?(canvas.width=data.width,canvas.height=data.width/aspectRatio):isNumber(data.height)&&(canvas.height=data.height,canvas.width=data.height*aspectRatio),this.renderCanvas(!0))},getCropBoxData:function(){var data,cropBox=this.cropBox;return this.built&&this.cropped&&(data={left:cropBox.left,top:cropBox.top,width:cropBox.width,height:cropBox.height}),data||{}},setCropBoxData:function(data){var cropBox=this.cropBox,aspectRatio=this.options.aspectRatio;this.built&&this.cropped&&!this.disabled&&$.isPlainObject(data)&&(isNumber(data.left)&&(cropBox.left=data.left),isNumber(data.top)&&(cropBox.top=data.top),isNumber(data.width)&&(cropBox.width=data.width),isNumber(data.height)&&(cropBox.height=data.height),aspectRatio&&(isNumber(data.width)?cropBox.height=cropBox.width/aspectRatio:isNumber(data.height)&&(cropBox.width=cropBox.height*aspectRatio)),this.renderCropBox())},getCroppedCanvas:function(options){var originalWidth,originalHeight,canvasWidth,canvasHeight,scaledWidth,scaledHeight,scaledRatio,aspectRatio,canvas,context,data;if(this.built&&this.cropped&&SUPPORT_CANVAS)return $.isPlainObject(options)||(options={}),data=this.getData(),originalWidth=data.width,originalHeight=data.height,aspectRatio=originalWidth/originalHeight,$.isPlainObject(options)&&(scaledWidth=options.width,scaledHeight=options.height,scaledWidth?(scaledHeight=scaledWidth/aspectRatio,scaledRatio=scaledWidth/originalWidth):scaledHeight&&(scaledWidth=scaledHeight*aspectRatio,scaledRatio=scaledHeight/originalHeight)),canvasWidth=scaledWidth||originalWidth,canvasHeight=scaledHeight||originalHeight,canvas=$("<canvas>")[0],canvas.width=canvasWidth,canvas.height=canvasHeight,context=canvas.getContext("2d"),options.fillColor&&(context.fillStyle=options.fillColor,context.fillRect(0,0,canvasWidth,canvasHeight)),context.drawImage.apply(context,function(){var srcWidth,srcHeight,dstX,dstY,dstWidth,dstHeight,source=getSourceCanvas(this.$clone[0],this.image),sourceWidth=source.width,sourceHeight=source.height,args=[source],srcX=data.x,srcY=data.y;return-originalWidth>=srcX||srcX>sourceWidth?srcX=srcWidth=dstX=dstWidth=0:0>=srcX?(dstX=-srcX,srcX=0,srcWidth=dstWidth=min(sourceWidth,originalWidth+srcX)):sourceWidth>=srcX&&(dstX=0,srcWidth=dstWidth=min(originalWidth,sourceWidth-srcX)),0>=srcWidth||-originalHeight>=srcY||srcY>sourceHeight?srcY=srcHeight=dstY=dstHeight=0:0>=srcY?(dstY=-srcY,srcY=0,srcHeight=dstHeight=min(sourceHeight,originalHeight+srcY)):sourceHeight>=srcY&&(dstY=0,srcHeight=dstHeight=min(originalHeight,sourceHeight-srcY)),args.push(srcX,srcY,srcWidth,srcHeight),scaledRatio&&(dstX*=scaledRatio,dstY*=scaledRatio,dstWidth*=scaledRatio,dstHeight*=scaledRatio),dstWidth>0&&dstHeight>0&&args.push(dstX,dstY,dstWidth,dstHeight),args}.call(this)),canvas},setAspectRatio:function(aspectRatio){var options=this.options;this.disabled||isUndefined(aspectRatio)||(options.aspectRatio=num(aspectRatio)||NaN,this.built&&(this.initCropBox(),this.cropped&&this.renderCropBox()))},setDragMode:function(mode){var croppable,movable,options=this.options;this.ready&&!this.disabled&&(croppable=options.dragCrop&&"crop"===mode,movable=options.movable&&"move"===mode,mode=croppable||movable?mode:"none",this.$dragBox.data("drag",mode).toggleClass(CLASS_CROP,croppable).toggleClass(CLASS_MOVE,movable),options.cropBoxMovable||this.$face.data("drag",mode).toggleClass(CLASS_CROP,croppable).toggleClass(CLASS_MOVE,movable))}}),prototype.change=function(shiftKey){var offset,dragType=this.dragType,options=this.options,canvas=this.canvas,container=this.container,cropBox=this.cropBox,width=cropBox.width,height=cropBox.height,left=cropBox.left,top=cropBox.top,right=left+width,bottom=top+height,minLeft=0,minTop=0,maxWidth=container.width,maxHeight=container.height,renderable=!0,aspectRatio=options.aspectRatio,range={x:this.endX-this.startX,y:this.endY-this.startY};switch(!aspectRatio&&shiftKey&&(aspectRatio=width&&height?width/height:1),options.strict&&(minLeft=cropBox.minLeft,minTop=cropBox.minTop,maxWidth=minLeft+min(container.width,canvas.width),maxHeight=minTop+min(container.height,canvas.height)),aspectRatio&&(range.X=range.y*aspectRatio,range.Y=range.x/aspectRatio),dragType){case"all":left+=range.x,top+=range.y;break;case"e":if(range.x>=0&&(right>=maxWidth||aspectRatio&&(minTop>=top||bottom>=maxHeight))){renderable=!1;break}width+=range.x,aspectRatio&&(height=width/aspectRatio,top-=range.Y/2),0>width&&(dragType="w",width=0);break;case"n":if(range.y<=0&&(minTop>=top||aspectRatio&&(minLeft>=left||right>=maxWidth))){renderable=!1;break}height-=range.y,top+=range.y,aspectRatio&&(width=height*aspectRatio,left+=range.X/2),0>height&&(dragType="s",height=0);break;case"w":if(range.x<=0&&(minLeft>=left||aspectRatio&&(minTop>=top||bottom>=maxHeight))){renderable=!1;break}width-=range.x,left+=range.x,aspectRatio&&(height=width/aspectRatio,top+=range.Y/2),0>width&&(dragType="e",width=0);break;case"s":if(range.y>=0&&(bottom>=maxHeight||aspectRatio&&(minLeft>=left||right>=maxWidth))){renderable=!1;break}height+=range.y,aspectRatio&&(width=height*aspectRatio,left-=range.X/2),0>height&&(dragType="n",height=0);break;case"ne":if(aspectRatio){if(range.y<=0&&(minTop>=top||right>=maxWidth)){renderable=!1;break}height-=range.y,top+=range.y,width=height*aspectRatio}else range.x>=0?maxWidth>right?width+=range.x:range.y<=0&&minTop>=top&&(renderable=!1):width+=range.x,range.y<=0?top>minTop&&(height-=range.y,top+=range.y):(height-=range.y,top+=range.y);0>width&&0>height?(dragType="sw",height=0,width=0):0>width?(dragType="nw",width=0):0>height&&(dragType="se",height=0);break;case"nw":if(aspectRatio){if(range.y<=0&&(minTop>=top||minLeft>=left)){renderable=!1;break}height-=range.y,top+=range.y,width=height*aspectRatio,left+=range.X}else range.x<=0?left>minLeft?(width-=range.x,left+=range.x):range.y<=0&&minTop>=top&&(renderable=!1):(width-=range.x,left+=range.x),range.y<=0?top>minTop&&(height-=range.y,top+=range.y):(height-=range.y,top+=range.y);0>width&&0>height?(dragType="se",height=0,width=0):0>width?(dragType="ne",width=0):0>height&&(dragType="sw",height=0);break;case"sw":if(aspectRatio){if(range.x<=0&&(minLeft>=left||bottom>=maxHeight)){renderable=!1;break}width-=range.x,left+=range.x,height=width/aspectRatio}else range.x<=0?left>minLeft?(width-=range.x,left+=range.x):range.y>=0&&bottom>=maxHeight&&(renderable=!1):(width-=range.x,left+=range.x),range.y>=0?maxHeight>bottom&&(height+=range.y):height+=range.y;0>width&&0>height?(dragType="ne",height=0,width=0):0>width?(dragType="se",width=0):0>height&&(dragType="nw",height=0);break;case"se":if(aspectRatio){if(range.x>=0&&(right>=maxWidth||bottom>=maxHeight)){renderable=!1;break}width+=range.x,height=width/aspectRatio}else range.x>=0?maxWidth>right?width+=range.x:range.y>=0&&bottom>=maxHeight&&(renderable=!1):width+=range.x,range.y>=0?maxHeight>bottom&&(height+=range.y):height+=range.y;0>width&&0>height?(dragType="nw",height=0,width=0):0>width?(dragType="sw",width=0):0>height&&(dragType="ne",height=0);break;case"move":canvas.left+=range.x,canvas.top+=range.y,this.renderCanvas(!0),renderable=!1;break;case"zoom":this.zoom(function(x1,y1,x2,y2){var z1=sqrt(x1*x1+y1*y1),z2=sqrt(x2*x2+y2*y2);return(z2-z1)/z1}(abs(this.startX-this.startX2),abs(this.startY-this.startY2),abs(this.endX-this.endX2),abs(this.endY-this.endY2))),this.startX2=this.endX2,this.startY2=this.endY2,renderable=!1;break;case"crop":range.x&&range.y&&(offset=this.$cropper.offset(),left=this.startX-offset.left,top=this.startY-offset.top,width=cropBox.minWidth,height=cropBox.minHeight,range.x>0?range.y>0?dragType="se":(dragType="ne",top-=height):range.y>0?(dragType="sw",left-=width):(dragType="nw",left-=width,top-=height),this.cropped||(this.cropped=!0,this.$cropBox.removeClass(CLASS_HIDDEN)))}renderable&&(cropBox.width=width,cropBox.height=height,cropBox.left=left,cropBox.top=top,this.dragType=dragType,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},$.extend(Cropper.prototype,prototype),Cropper.DEFAULTS={aspectRatio:NaN,autoCropArea:.8,crop:null,data:null,preview:"",strict:!0,responsive:!0,checkImageOrigin:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,dragCrop:!0,movable:!0,rotatable:!0,zoomable:!0,touchDragZoom:!0,mouseWheelZoom:!0,cropBoxMovable:!0,cropBoxResizable:!0,doubleClickToggle:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,dragstart:null,dragmove:null,dragend:null,zoomin:null,zoomout:null,change:null},Cropper.setDefaults=function(options){$.extend(Cropper.DEFAULTS,options)},Cropper.TEMPLATE=function(source,words){return words=words.split(","),source.replace(/\d+/g,function(i){return words[i]})}('<0 6="5-container"><0 6="5-canvas"></0><0 6="5-2-9"></0><0 6="5-crop-9"><1 6="5-view-9"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-center"></1><1 6="5-face"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>',"div,span,drag,data,point,cropper,class,line,dashed,box"),Cropper.other=$.fn.cropper,$.fn.cropper=function(options){var result,args=toArray(arguments,1);return this.each(function(){var fn,$this=$(this),data=$this.data("cropper");if(!data){if(/destroy/.test(options))return;$this.data("cropper",data=new Cropper(this,options))}"string"==typeof options&&$.isFunction(fn=data[options])&&(result=fn.apply(data,args))}),isUndefined(result)?this:result},$.fn.cropper.Constructor=Cropper,$.fn.cropper.setDefaults=Cropper.setDefaults,$.fn.cropper.noConflict=function(){return $.fn.cropper=Cropper.other,this}});